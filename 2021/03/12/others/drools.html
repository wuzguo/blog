<!DOCTYPE HTML>
<html class="no-js" lang="zh-CN">
<!--
//                            _ooOoo_
//                           o8888888o
//                           88" . "88
//                           (| -_- |)
//                            O\ = /O
//                        ____/`---'\____
//                      .   ' \\| |// `.
//                       / \\||| : |||// \
//                     / _||||| -:- |||||- \
//                       | | \\\ - /// | |
//                     | \_| ''\---/'' | |
//                      \ .-\__ `-` ___/-. /
//                   ___`. .' /--.--\ `. . __
//                ."" '< `.___\_<|>_/___.' >'"".
//               | | : `- \`.;`\ _ /`;.`/ - ` : | |
//                 \ \ `-. \_ __\ /__ _/ .-` / /
//         ======`-.____`-.___\_____/___.-`____.-'======
//                            `=---='
//                 拦截插件累计拦截逗比攻击"1381438"次！
//         .............................................
//                  佛祖保佑             永无BUG
//          佛曰:
//                  写字楼里写字间，写字间里程序员；
//                  程序人员写程序，又拿程序换酒钱。
//                  酒醒只在网上坐，酒醉还来网下眠；
//                  酒醉酒醒日复日，网上网下年复年。
//                  但愿老死电脑间，不愿鞠躬老板前；
//                  奔驰宝马贵者趣，公交自行程序员。
//                  别人笑我忒疯癫，我笑自己命太贱；
//                  不见满街漂亮妹，哪个归得程序员？
-->
<head>
    <!--[if lte IE 9]>
<meta http-equiv="refresh" content="0;url=http://wuzguo.com/blog/warn.html">
<![endif]-->
<meta charset="utf-8">

<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<meta http-equiv="mobile-agent" content="format=html5; url=http://wuzguo.com/blog">
<meta name="author" content="Zàk (https://github.com/wuzguo)">

<link rel="stylesheet" href="/blog/css/SimpleStyle.css">


<!--代码高亮-->

<link rel="stylesheet" href="/blog/css/highlight/styles/default.css">

<!--使用Github风格的代码样式-->

<link rel="stylesheet" href="/blog/css/highlight/styles/github.css">


<link rel="shortcut icon" href="/blog/images/fav.ico">


<title>
    
    规则引擎 drools -
    
    Zak&#39;s Home
    
</title>

<meta name="keywords" content="规则引擎，Drools">

<meta name="description " content="规则引擎 Drools学习指南">
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
<div id="nav">
    <nav class="nav-menu">
        <a class="site-name current" href="/blog/" title="Zàk">Zàk</a>
        <a class="site-index current" href="/blog/"><i class="fa fa-home"></i><span>首页</span></a>
        <a href="/blog/archives/" title="归档"><i class="fa fa-archives"></i><span>归档</span></a>
        <a href="/blog/tags/" title="标签"><i class="fa fa-tags"></i><span>标签</span></a>
        <a href="/blog/video/" title="视频"><i class="fa fa-video-camera"></i><span>视频</span></a>
        <a href="/blog/cross_fire/" title="链接"><i class="fa fa-wifi"></i><span>链接</span></a>
        <a href="/blog/help/" title="帮助"><i class="fa fa-question-circle"></i><span>帮助</span></a>
    </nav>
</div>
<div class="nav-user">
    <a class="btn-search" href="#"><i class="fa fa-search"></i></a>
    <a class="btn-read-mode" href="#"><i class="fa fa-sun-o"></i></a>
    <a class="btn-weixin-mp" href="javascript:"><i class="fa fa-weixin"></i></a>
</div>
<div id="wrapper" class="clearfix">
    <div id="body">
        <div class="main" id="main">
            <div id="cover">
    <div class="cover-img"></div>
    <div class="cover-info">
        <img class="avatar" width="72" src="/blog/images/avatar.png" alt="avatar" />
        <h1>Zàk</h1>
        <h4>日拱一卒，功不唐捐</h4>
        <p>一个追求进步的「十八线码农」</p>
        <div class="cover-sns">
            <div class="btn btn-homepage">
                <a href="http://wuzguo.com" target="_blank" rel="nofollow"><i class="fa fa-homepage"></i></a>
            </div>
            <div class="btn btn-github">
                <a href="https://github.com/wuzguo"  target="_blank" rel="nofollow"><i class="fa fa-github"></i></a>
            </div>
            <div class="btn btn-stack-overflow">
                <a href="https://stackoverflow.com/users/6716643/wuzguo" target="_blank" rel="nofollow"><i class="fa fa-stack-overflow"></i></a>
            </div>
            <div class="btn btn-facebook">
                <a href="https://www.facebook.com/wu.xsen"  target="_blank" rel="nofollow"><i class="fa fa-facebook"></i></a>
            </div>
        </div>
    </div>
</div>
            <div class="page-title">
    <ul>
        <li><a href="/blog/">最新</a></li>
        
            
                <li class="">
                    <a href="/blog/categories/server/" data-name="后台">后台</a>
                </li>
            
                <li class="">
                    <a href="/blog/categories/front/" data-name="前端">前端</a>
                </li>
            
                <li class="">
                    <a href="/blog/categories/db/" data-name="数据库">数据库</a>
                </li>
            
                <li class="">
                    <a href="/blog/categories/os/" data-name="操作系统">操作系统</a>
                </li>
            
                <li class="">
                    <a href="/blog/categories/iot/" data-name="IoT">IoT</a>
                </li>
            
                <li class="">
                    <a href="/blog/categories/bigdata/" data-name="大数据">大数据</a>
                </li>
            
                <li class="">
                    <a href="/blog/categories/tools/" data-name="工具">工具</a>
                </li>
            
                <li class="active">
                    <a href="/blog/categories/others/" data-name="其他">其他</a>
                </li>
            
        
        <li class="page-search">
    <form id="search" class="search-form">
        <label for="s" class="sr-only">请输入关键字</label>
        <input class="search-field" type="text" name="s" class="text" placeholder="请输入关键字" />
        <button type="submit" class="search-form-submit" title="搜索"><i class="fa fa-search"></i></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/blog/',
        CONTENT_URL: '/blog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
</li>

    </ul>
</div>
<div class="main-inner">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="post-header">
            <div class="post-author clearfix">
                <a class="avatar fleft" href="http://www.wuzguo.com" target="_blank">
                    <img width="48" src="/blog/images/avatar.png" alt="avatar"/>
                </a>
                <p><span class="label">作者</span>
                    <a href="https://github.com/wuzguo" target="_blank">Zak</a>
                    <span title="最后编辑于2021-03-12">2021-03-12</span>
                </p>
                <p>一个追求进步的「十八线码农」</p>
            </div>
            <h2 class="post-title">规则引擎 Drools</h2>
            <div class="post-meta">
                本文总共117723个字 | 您是第<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>位看到它们的小伙伴
            </div>
        </div>
        <div class="post-content markdown-body">
            <h2 id="1-问题引出"><a href="#1-问题引出" class="headerlink" title="1. 问题引出"></a>1. 问题引出</h2><p>现有一个在线申请信用卡的业务场景，用户需要录入个人信息，如下图所示：</p>
<p><img src="/blog/images/202103/image-20200114163727767.png" alt="image-20200114163727767"></p>
<p>通过上图可以看到，用户录入的个人信息包括姓名、性别、年龄、学历、电话、所在公司、职位、月收入、是否有房、是否有车、是否有信用卡等。录入完成后点击申请按钮提交即可。</p>
<p>用户提交申请后，需要在系统的服务端进行<strong>用户信息合法性检查</strong>(是否有资格申请信用卡)，只有通过合法性检查的用户才可以成功申请到信用卡(注意：不同用户有可能申请到的信用卡额度不同)。</p>
<p>检查用户信息合法性的规则如下：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">检查学历与薪水1</td>
<td align="left">如果申请人既没房也没车，同时学历为大专以下，并且月薪少于5000，那么不通过</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">检查学历与薪水2</td>
<td align="left">如果申请人既没房也没车，同时学历为大专或本科，并且月薪少于3000，那么不通过</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">检查学历与薪水3</td>
<td align="left">如果申请人既没房也没车，同时学历为本科以上，并且月薪少于2000，同时之前没有信用卡的，那么不通过</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">检查申请人已有的信用卡数量</td>
<td align="left">如果申请人现有的信用卡数量大于10，那么不通过</td>
</tr>
</tbody></table>
<p>用户信息合法性检查通过后，还需要根据如下<strong>信用卡发放规则</strong>确定用户所办信用卡的额度：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">规则1</td>
<td align="left">如果申请人有房有车，或者月收入在20000以上，那么发放的信用卡额度为15000</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">规则2</td>
<td align="left">如果申请人没房没车，但月收入在10000~20000之间，那么发放的信用卡额度为6000</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">规则3</td>
<td align="left">如果申请人没房没车，月收入在10000以下，那么发放的信用卡额度为3000</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">规则4</td>
<td align="left">如果申请人有房没车或者没房但有车，月收入在10000以下，那么发放的信用卡额度为5000</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">规则5</td>
<td align="left">如果申请人有房没车或者是没房但有车，月收入在10000~20000之间，那么发放的信用卡额度为8000</td>
</tr>
</tbody></table>
<p>思考：如何实现上面的业务逻辑呢？</p>
<p>我们最容易想到的就是使用分支判断(if else)来实现，例如通过如下代码来检查用户信息合法性:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//此处为伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//检查用户信息合法性，返回true表示检查通过，返回false表示检查不通过</span></span><br><span class="line"><span class="keyword">public</span> boolean checkUser(User user)&#123;</span><br><span class="line">    <span class="comment">//如果申请人既没房也没车，同时学历为大专以下，并且月薪少于5000，那么不通过</span></span><br><span class="line">    <span class="keyword">if</span>(user.getHouse() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getcar() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getEducation().equals(<span class="string">&quot;大专以下&quot;</span>) </span><br><span class="line">       &amp;&amp; user.getSalary &lt; <span class="number">5000</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人既没房也没车，同时学历为大专或本科，并且月薪少于3000，那么不通过</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(user.getHouse() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getcar() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getEducation().equals(<span class="string">&quot;大专或本科&quot;</span>) </span><br><span class="line">       &amp;&amp; user.getSalary &lt; <span class="number">3000</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人既没房也没车，同时学历为本科以上，并且月薪少于2000，同时之前没有信用卡的，那么不通过</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(user.getHouse() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getcar() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getEducation().equals(<span class="string">&quot;本科以上&quot;</span>) </span><br><span class="line">       &amp;&amp; user.getSalary &lt; <span class="number">2000</span> </span><br><span class="line">       &amp;&amp; user.getHasCreditCard() == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人现有的信用卡数量大于10，那么不通过</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(user.getCreditCardCount() &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果用户信息合法性检查通过后，还需要通过如下代码确定用户所办信用卡的额度：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//此处为伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户输入信息确定信用卡额度</span></span><br><span class="line"><span class="keyword">public</span> Integer determineCreditCardLimit(User user)&#123;</span><br><span class="line">    <span class="comment">//如果申请人有房有车，或者月收入在20000以上，那么发放的信用卡额度为15000</span></span><br><span class="line">    <span class="keyword">if</span>((user.getHouse() != <span class="literal">null</span> &amp;&amp; user.getcar() != <span class="literal">null</span>) </span><br><span class="line">       || user.getSalary() &gt; <span class="number">20000</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">15000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人没房没车，并且月收入在10000到20000之间，那么发放的信用卡额度为6000</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(user.getHouse() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getcar() == <span class="literal">null</span></span><br><span class="line">       &amp;&amp; user.getSalary() &gt; <span class="number">10000</span> </span><br><span class="line">       &amp;&amp; user.getSalary() &lt; <span class="number">20000</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">6000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人没房没车，并且月收入在10000以下，那么发放的信用卡额度为3000</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(user.getHouse() == <span class="literal">null</span> </span><br><span class="line">       &amp;&amp; user.getcar() == <span class="literal">null</span></span><br><span class="line">       &amp;&amp; user.getSalary() &lt; <span class="number">10000</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人有房没车或者没房但有车，并且月收入在10000以下，那么发放的信用卡额度为5000</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((((user.getHouse() != <span class="literal">null</span> &amp;&amp; user.getcar() == <span class="literal">null</span>) || (user.getHouse() == <span class="literal">null</span> &amp;&amp; user.getcar() != <span class="literal">null</span>))</span><br><span class="line">       &amp;&amp; user.getSalary() &lt; <span class="number">10000</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果申请人有房没车或者没房但有车，并且月收入在10000到20000之间，那么发放的信用卡额度为8000</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((((user.getHouse() != <span class="literal">null</span> &amp;&amp; user.getcar() == <span class="literal">null</span>) || (user.getHouse() == <span class="literal">null</span> &amp;&amp; user.getcar() != <span class="literal">null</span>))</span><br><span class="line">       &amp;&amp; (user.getSalary() &gt; <span class="number">10000</span> &amp;&amp; user.getSalary() &lt; <span class="number">20000</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">8000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 通过上面的伪代码我们可以看到，我们的业务规则是通过Java代码的方式实现的。这种实现方式存在如下问题：</p>
<p>1、硬编码实现业务规则难以维护</p>
<p>2、硬编码实现业务规则难以应对变化</p>
<p>3、业务规则发生变化需要修改代码，重启服务后才能生效</p>
<p>那么面对上面的业务场景，还有什么好的实现方式吗？</p>
<p>答案是<strong>规则引擎</strong>。</p>
<h2 id="2-规则引擎概述"><a href="#2-规则引擎概述" class="headerlink" title="2. 规则引擎概述"></a>2. 规则引擎概述</h2><h3 id="2-1-什么是规则引擎"><a href="#2-1-什么是规则引擎" class="headerlink" title="2.1 什么是规则引擎"></a>2.1 什么是规则引擎</h3><p><strong>规则引擎</strong>，全称为<strong>业务规则管理系统</strong>，英文名为BRMS(即Business Rule Management System)。规则引擎的主要思想是将应用程序中的业务决策部分分离出来，并使用预定义的语义模块编写业务决策（业务规则），由用户或开发者在需要时进行配置、管理。</p>
<p>需要注意的是规则引擎并不是一个具体的技术框架，而是指的一类系统，即业务规则管理系统。目前市面上具体的规则引擎产品有：drools、VisualRules、iLog等。</p>
<p>规则引擎实现了将业务决策从应用程序代码中分离出来，接收数据输入，解释业务规则，并根据业务规则做出业务决策。规则引擎其实就是一个输入输出平台。</p>
<p>上面的申请信用卡业务场景使用规则引擎后效果如下：</p>
<p><img src="/blog/images/202103/4.png" alt="4"></p>
<p>系统中引入规则引擎后，业务规则不再以程序代码的形式驻留在系统中，取而代之的是处理规则的规则引擎，业务规则存储在规则库中，完全独立于程序。业务人员可以像管理数据一样对业务规则进行管理，比如查询、添加、更新、统计、提交业务规则等。业务规则被加载到规则引擎中供应用系统调用。</p>
<h3 id="2-2-使规则引擎的优势"><a href="#2-2-使规则引擎的优势" class="headerlink" title="2.2 使规则引擎的优势"></a>2.2 使规则引擎的优势</h3><p>使用规则引擎的优势如下：</p>
<p>1、业务规则与系统代码分离，实现业务规则的集中管理</p>
<p>2、在不重启服务的情况下可随时对业务规则进行扩展和维护</p>
<p>3、可以动态修改业务规则，从而快速响应需求变更</p>
<p>4、规则引擎是相对独立的，只关心业务规则，使得业务分析人员也可以参与编辑、维护系统的业务规则</p>
<p>5、减少了硬编码业务规则的成本和风险</p>
<p>6、使用规则引擎提供的规则编辑工具，使复杂的业务规则实现变得的简单</p>
<h3 id="2-3-规则引擎应用场景"><a href="#2-3-规则引擎应用场景" class="headerlink" title="2.3 规则引擎应用场景"></a>2.3 规则引擎应用场景</h3><p>对于一些存在比较复杂的业务规则并且业务规则会频繁变动的系统比较适合使用规则引擎，如下：</p>
<p>1、风险控制系统—-风险贷款、风险评估</p>
<p>2、反欺诈项目—-银行贷款、征信验证</p>
<p>3、决策平台系统—-财务计算</p>
<p>4、促销平台系统—-满减、打折、加价购</p>
<h3 id="2-4-Drools介绍"><a href="#2-4-Drools介绍" class="headerlink" title="2.4 Drools介绍"></a>2.4 Drools介绍</h3><p>drools是一款由JBoss组织提供的基于Java语言开发的开源规则引擎，可以将复杂且多变的业务规则从硬编码中解放出来，以规则脚本的形式存放在文件或特定的存储介质中(例如存放在数据库中)，使得业务规则的变更不需要修改项目代码、重启服务器就可以在线上环境立即生效。</p>
<p>drools官网地址：<a href="https://drools.org/">https://drools.org/</a></p>
<p>drools源码下载地址：<a href="https://github.com/kiegroup/drools">https://github.com/kiegroup/drools</a></p>
<p>在项目中使用drools时，即可以单独使用也可以整合spring使用。如果单独使用只需要导入如下maven坐标即可：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们使用IDEA开发drools应用，IDEA中已经集成了drools插件。如果使用eclipse开发drools应用还需要单独安装drools插件。</p>
<p>drools API开发步骤如下：<img src="/blog/images/202103/5.png" alt="5"></p>
<h2 id="3-Drools入门案例"><a href="#3-Drools入门案例" class="headerlink" title="3. Drools入门案例"></a>3. Drools入门案例</h2><p>本小节通过一个Drools入门案例来让大家初步了解Drools的使用方式、对Drools有一个整体概念。</p>
<h3 id="3-1-业务场景说明"><a href="#3-1-业务场景说明" class="headerlink" title="3.1 业务场景说明"></a>3.1 业务场景说明</h3><p>业务场景：消费者在图书商城购买图书，下单后需要在支付页面显示订单优惠后的价格。具体优惠规则如下：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">规则名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">规则一</td>
<td align="left">所购图书总价在100元以下的没有优惠</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">规则二</td>
<td align="left">所购图书总价在100到200元的优惠20元</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">规则三</td>
<td align="left">所购图书总价在200到300元的优惠50元</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">规则四</td>
<td align="left">所购图书总价在300元以上的优惠100元</td>
</tr>
</tbody></table>
<p>现在需要根据上面的规则计算优惠后的价格。</p>
<h3 id="3-2-开发实现"><a href="#3-2-开发实现" class="headerlink" title="3.2 开发实现"></a>3.2 开发实现</h3><p>第一步：创建maven工程drools_quickstart并导入drools相关maven坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：根据drools要求创建resources&#x2F;META-INF&#x2F;kmodule.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">kmodule</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.drools.org/xsd/kmodule&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        name:指定kbase的名称，可以任意，但是需要唯一</span></span><br><span class="line"><span class="comment">        packages:指定规则文件的目录，需要根据实际情况填写，否则无法加载到规则文件</span></span><br><span class="line"><span class="comment">        default:指定当前kbase是否为默认</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kbase</span> <span class="attr">name</span>=<span class="string">&quot;myKbase1&quot;</span> <span class="attr">packages</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            name:指定ksession名称，可以任意，但是需要唯一</span></span><br><span class="line"><span class="comment">            default:指定当前session是否为默认</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ksession</span> <span class="attr">name</span>=<span class="string">&quot;ksession-rule&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">kbase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">kmodule</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：上面配置文件的名称和位置都是固定写法，不能更改</p>
<p>第三步：创建实体类Order</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>.<span class="property">entity</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Double</span> originalPrice;<span class="comment">//订单原始价格，即优惠前价格</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Double</span> realPrice;<span class="comment">//订单真实价格，即优惠后价格</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Order&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;originalPrice=&quot;</span> + originalPrice +</span><br><span class="line">                <span class="string">&quot;, realPrice=&quot;</span> + realPrice +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Double</span> <span class="title function_">getOriginalPrice</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setOriginalPrice</span>(<span class="params">Double originalPrice</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">originalPrice</span> = originalPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Double</span> <span class="title function_">getRealPrice</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> realPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setRealPrice</span>(<span class="params">Double realPrice</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">realPrice</span> = realPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：创建规则文件resources&#x2F;rules&#x2F;bookDiscount.drl</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//图书优惠规则</span></span><br><span class="line">package book.discount</span><br><span class="line">import com.itheima.drools.entity.Order</span><br><span class="line"></span><br><span class="line"><span class="comment">//规则一：所购图书总价在100元以下的没有优惠</span></span><br><span class="line">rule <span class="string">&quot;book_discount_1&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $order:<span class="constructor">Order(<span class="params">originalPrice</span> &lt; 100)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则一：所购图书总价在100元以下的没有优惠&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//规则二：所购图书总价在100到200元的优惠20元</span></span><br><span class="line">rule <span class="string">&quot;book_discount_2&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $order:<span class="constructor">Order(<span class="params">originalPrice</span> &lt; 200 <span class="operator">&amp;&amp;</span> <span class="params">originalPrice</span> &gt;= 100)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span> - <span class="number">20</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则二：所购图书总价在100到200元的优惠20元&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//规则三：所购图书总价在200到300元的优惠50元</span></span><br><span class="line">rule <span class="string">&quot;book_discount_3&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $order:<span class="constructor">Order(<span class="params">originalPrice</span> &lt;= 300 <span class="operator">&amp;&amp;</span> <span class="params">originalPrice</span> &gt;= 200)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span> - <span class="number">50</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则三：所购图书总价在200到300元的优惠50元&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//规则四：所购图书总价在300元以上的优惠100元</span></span><br><span class="line">rule <span class="string">&quot;book_discount_4&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $order:<span class="constructor">Order(<span class="params">originalPrice</span> &gt;= 300)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span> - <span class="number">100</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则四：所购图书总价在300元以上的优惠100元&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第五步：编写单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1<span class="literal">()</span>&#123;</span><br><span class="line">    KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">    KieContainer kieClasspathContainer = kieServices.get<span class="constructor">KieClasspathContainer()</span>;</span><br><span class="line">    <span class="comment">//会话对象，用于和规则引擎交互</span></span><br><span class="line">    KieSession kieSession = kieClasspathContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造订单对象，设置原始价格，由规则引擎根据优惠规则计算优惠后的价格</span></span><br><span class="line">    Order order = <span class="keyword">new</span> <span class="constructor">Order()</span>;</span><br><span class="line">    order.set<span class="constructor">OriginalPrice(210D)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将数据提供给规则引擎，规则引擎会根据提供的数据进行规则匹配</span></span><br><span class="line">    kieSession.insert(order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//激活规则引擎，如果规则匹配成功则执行规则</span></span><br><span class="line">    kieSession.fire<span class="constructor">AllRules()</span>;</span><br><span class="line">    <span class="comment">//关闭会话</span></span><br><span class="line">    kieSession.dispose<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;优惠前原始价格：&quot;</span> + order.get<span class="constructor">OriginalPrice()</span> +</span><br><span class="line">                       <span class="string">&quot;，优惠后价格：&quot;</span> + order.get<span class="constructor">RealPrice()</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面的入门案例我们可以发现，使用drools规则引擎主要工作就是编写规则文件，在规则文件中定义跟业务相关的业务规则，例如本案例定义的就是图书优惠规则。规则定义好后就需要调用drools提供的API将数据提供给规则引擎进行规则模式匹配，规则引擎会执行匹配成功的规则并将计算的结果返回给我们。</p>
<p>可能大家会有疑问，就是我们虽然没有在代码中编写规则的判断逻辑，但是我们还是在规则文件中编写了业务规则，这跟在代码中编写规则有什么本质的区别呢？</p>
<p>我们前面其实已经提到，使用规则引擎时业务规则可以做到动态管理。业务人员可以像管理数据一样对业务规则进行管理，比如查询、添加、更新、统计、提交业务规则等。这样就可以做到在不重启服务的情况下调整业务规则。</p>
<h3 id="3-3-小结"><a href="#3-3-小结" class="headerlink" title="3.3 小结"></a>3.3 小结</h3><h4 id="3-3-1-规则引擎构成"><a href="#3-3-1-规则引擎构成" class="headerlink" title="3.3.1 规则引擎构成"></a>3.3.1 规则引擎构成</h4><p>drools规则引擎由以下三部分构成：</p>
<ul>
<li>Working Memory（工作内存）</li>
<li>Rule Base（规则库）</li>
<li>Inference Engine（推理引擎）</li>
</ul>
<p>其中Inference Engine（推理引擎）又包括：</p>
<ul>
<li>Pattern Matcher（匹配器）</li>
<li>Agenda(议程)</li>
<li>Execution Engine（执行引擎）</li>
</ul>
<p>如下图所示：</p>
<p><img src="/blog/images/202103/8.png" alt="8"></p>
<h4 id="3-3-2-相关概念说明"><a href="#3-3-2-相关概念说明" class="headerlink" title="3.3.2 相关概念说明"></a>3.3.2 相关概念说明</h4><p><strong>Working Memory</strong>：工作内存，drools规则引擎会从Working Memory中获取数据并和规则文件中定义的规则进行模式匹配，所以我们开发的应用程序只需要将我们的数据插入到Working Memory中即可，例如本案例中我们调用kieSession.insert(order)就是将order对象插入到了工作内存中。</p>
<p><strong>Fact</strong>：事实，是指在drools 规则应用当中，将一个普通的JavaBean插入到Working Memory后的对象就是Fact对象，例如本案例中的Order对象就属于Fact对象。Fact对象是我们的应用和规则引擎进行数据交互的桥梁或通道。</p>
<p><strong>Rule Base</strong>：规则库，我们在规则文件中定义的规则都会被加载到规则库中。</p>
<p><strong>Pattern Matcher</strong>：匹配器，将Rule Base中的所有规则与Working Memory中的Fact对象进行模式匹配，匹配成功的规则将被激活并放入Agenda中。</p>
<p><strong>Agenda</strong>：议程，用于存放通过匹配器进行模式匹配后被激活的规则。</p>
<p><strong>Execution Engine</strong>：执行引擎，执行Agenda中被激活的规则。</p>
<h4 id="3-3-3-规则引擎执行过程"><a href="#3-3-3-规则引擎执行过程" class="headerlink" title="3.3.3 规则引擎执行过程"></a>3.3.3 规则引擎执行过程</h4><p><img src="/blog/images/202103/10.png" alt="10"></p>
<h4 id="3-3-4-KIE介绍"><a href="#3-3-4-KIE介绍" class="headerlink" title="3.3.4 KIE介绍"></a>3.3.4 KIE介绍</h4><p>我们在操作Drools时经常使用的API以及它们之间的关系如下图：</p>
<p><img src="/blog/images/202103/9.png" alt="9"></p>
<p>通过上面的核心API可以发现，大部分类名都是以Kie开头。Kie全称为Knowledge Is Everything，即”知识就是一切”的缩写，是Jboss一系列项目的总称。如下图所示，Kie的主要模块有OptaPlanner、Drools、UberFire、jBPM。</p>
<p><img src="/blog/images/202103/11.png" alt="11"></p>
<p>通过上图可以看到，Drools是整个KIE项目中的一个组件，Drools中还包括一个Drools-WB的模块，它是一个可视化的规则编辑器。</p>
<h2 id="4-Drools基础语法"><a href="#4-Drools基础语法" class="headerlink" title="4. Drools基础语法"></a>4. Drools基础语法</h2><h3 id="4-1-规则文件构成"><a href="#4-1-规则文件构成" class="headerlink" title="4.1 规则文件构成"></a>4.1 规则文件构成</h3><p>在使用Drools时非常重要的一个工作就是编写规则文件，通常规则文件的后缀为.drl。</p>
<p>drl是Drools Rule Language的缩写。在规则文件中编写具体的规则内容。</p>
<p>一套完整的规则文件内容构成如下：</p>
<table>
<thead>
<tr>
<th align="left">关键字</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">package</td>
<td align="left">包名，只限于逻辑上的管理，同一个包名下的查询或者函数可以直接调用</td>
</tr>
<tr>
<td align="left">import</td>
<td align="left">用于导入类或者静态方法</td>
</tr>
<tr>
<td align="left">global</td>
<td align="left">全局变量</td>
</tr>
<tr>
<td align="left">function</td>
<td align="left">自定义函数</td>
</tr>
<tr>
<td align="left">query</td>
<td align="left">查询</td>
</tr>
<tr>
<td align="left">rule end</td>
<td align="left">规则体</td>
</tr>
</tbody></table>
<p>Drools支持的规则文件，除了drl形式，还有Excel文件类型的。</p>
<h3 id="4-2-规则体语法结构"><a href="#4-2-规则体语法结构" class="headerlink" title="4.2 规则体语法结构"></a>4.2 规则体语法结构</h3><p>规则体是规则文件内容中的重要组成部分，是进行业务规则判断、处理业务结果的部分。</p>
<p>规则体语法结构如下：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rule</span> &quot;ruleName&quot;</span><br><span class="line">    attributes</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        LHS</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        RHS</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p><strong>rule</strong>：关键字，表示规则开始，参数为规则的唯一名称。</p>
<p><strong>attributes</strong>：规则属性，是rule与when之间的参数，为可选项。</p>
<p><strong>when</strong>：关键字，后面跟规则的条件部分。</p>
<p><strong>LHS</strong>(Left Hand Side)：是规则的条件部分的通用名称。它由零个或多个条件元素组成。如果LHS为空，则它将被视为始终为true的条件元素。</p>
<p><strong>then</strong>：关键字，后面跟规则的结果部分。</p>
<p><strong>RHS</strong>(Right Hand Side)：是规则的后果或行动部分的通用名称。</p>
<p><strong>end</strong>：关键字，表示一个规则结束。</p>
<h3 id="4-3-注释"><a href="#4-3-注释" class="headerlink" title="4.3 注释"></a>4.3 注释</h3><p>在drl形式的规则文件中使用注释和Java类中使用注释一致，分为单行注释和多行注释。</p>
<p>单行注释用”&#x2F;&#x2F;“进行标记，多行注释以”&#x2F;<em>“开始，以”</em>&#x2F;“结束。如下示例：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">//规则rule1的注释，这是一个单行注释</span><br><span class="line"><span class="keyword">rule</span> &quot;rule1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;rule1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">规则rule2的注释，</span></span><br><span class="line"><span class="comment">这是一个多行注释</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">rule</span> &quot;rule2&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;rule2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-Pattern模式匹配"><a href="#4-4-Pattern模式匹配" class="headerlink" title="4.4 Pattern模式匹配"></a>4.4 Pattern模式匹配</h3><p>前面我们已经知道了Drools中的匹配器可以将Rule Base中的所有规则与Working Memory中的Fact对象进行模式匹配，那么我们就需要在规则体的LHS部分定义规则并进行模式匹配。LHS部分由一个或者多个条件组成，条件又称为pattern。</p>
<p>pattern的语法结构为：绑定变量名:Object(Field约束)</p>
<p>其中绑定变量名可以省略，通常绑定变量名的命名一般建议以$开始。如果定义了绑定变量名，就可以在规则体的RHS部分使用此绑定变量名来操作相应的Fact对象。Field约束部分是需要返回true或者false的0个或多个表达式。</p>
<p>例如我们的入门案例中：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//规则二：所购图书总价在100到200元的优惠20元</span></span><br><span class="line">rule <span class="string">&quot;book_discount_2&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="comment">//Order为类型约束，originalPrice为属性约束</span></span><br><span class="line">        $order:<span class="constructor">Order(<span class="params">originalPrice</span> &lt; 200 <span class="operator">&amp;&amp;</span> <span class="params">originalPrice</span> &gt;= 100)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span> - <span class="number">20</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则二：所购图书总价在100到200元的优惠20元&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>通过上面的例子我们可以知道，匹配的条件为：</p>
<p>1、工作内存中必须存在Order这种类型的Fact对象—–类型约束</p>
<p>2、Fact对象的originalPrice属性值必须小于200——属性约束</p>
<p>3、Fact对象的originalPrice属性值必须大于等于100——属性约束</p>
<p>以上条件必须同时满足当前规则才有可能被激活。</p>
<p>绑定变量既可以用在对象上，也可以用在对象的属性上。例如上面的例子可以改为：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//规则二：所购图书总价在100到200元的优惠20元</span></span><br><span class="line">rule <span class="string">&quot;book_discount_2&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $order:<span class="constructor">Order($<span class="params">op</span>:<span class="params">originalPrice</span> &lt; 200 <span class="operator">&amp;&amp;</span> <span class="params">originalPrice</span> &gt;= 100)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;$op=&quot;</span> + $op);</span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span> - <span class="number">20</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则二：所购图书总价在100到200元的优惠20元&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>LHS部分还可以定义多个pattern，多个pattern之间可以使用and或者or进行连接，也可以不写，默认连接为and。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//规则二：所购图书总价在100到200元的优惠20元</span></span><br><span class="line">rule <span class="string">&quot;book_discount_2&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $order:<span class="constructor">Order($<span class="params">op</span>:<span class="params">originalPrice</span> &lt; 200 <span class="operator">&amp;&amp;</span> <span class="params">originalPrice</span> &gt;= 100)</span> <span class="keyword">and</span></span><br><span class="line">        $customer:<span class="constructor">Customer(<span class="params">age</span> &gt; 20 <span class="operator">&amp;&amp;</span> <span class="params">gender</span><span class="operator">==</span>&#x27;<span class="params">male</span>&#x27;)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;$op=&quot;</span> + $op);</span><br><span class="line">        $order.set<span class="constructor">RealPrice($<span class="params">order</span>.<span class="params">getOriginalPrice</span>()</span> - <span class="number">20</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;成功匹配到规则二：所购图书总价在100到200元的优惠20元&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-比较操作符"><a href="#4-5-比较操作符" class="headerlink" title="4.5 比较操作符"></a>4.5 比较操作符</h3><p>Drools提供的比较操作符，如下表：</p>
<table>
<thead>
<tr>
<th align="left">符号</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&gt;</td>
<td align="left">大于</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于</td>
</tr>
<tr>
<td align="left">&gt;&#x3D;</td>
<td align="left">大于等于</td>
</tr>
<tr>
<td align="left">&lt;&#x3D;</td>
<td align="left">小于等于</td>
</tr>
<tr>
<td align="left">&#x3D;&#x3D;</td>
<td align="left">等于</td>
</tr>
<tr>
<td align="left">!&#x3D;</td>
<td align="left">不等于</td>
</tr>
<tr>
<td align="left">contains</td>
<td align="left">检查一个Fact对象的某个属性值是否包含一个指定的对象值</td>
</tr>
<tr>
<td align="left">not contains</td>
<td align="left">检查一个Fact对象的某个属性值是否不包含一个指定的对象值</td>
</tr>
<tr>
<td align="left">memberOf</td>
<td align="left">判断一个Fact对象的某个属性是否在一个或多个集合中</td>
</tr>
<tr>
<td align="left">not memberOf</td>
<td align="left">判断一个Fact对象的某个属性是否不在一个或多个集合中</td>
</tr>
<tr>
<td align="left">matches</td>
<td align="left">判断一个Fact对象的属性是否与提供的标准的Java正则表达式进行匹配</td>
</tr>
<tr>
<td align="left">not matches</td>
<td align="left">判断一个Fact对象的属性是否不与提供的标准的Java正则表达式进行匹配</td>
</tr>
</tbody></table>
<p>前6个比较操作符和Java中的完全相同，下面我们重点学习后6个比较操作符。</p>
<h4 id="4-5-1-语法"><a href="#4-5-1-语法" class="headerlink" title="4.5.1 语法"></a>4.5.1 语法</h4><ul>
<li><p><strong>contains | not contains语法结构</strong></p>
<p>  Object(Field[Collection&#x2F;Array] contains value)</p>
<p>  Object(Field[Collection&#x2F;Array] not contains value)</p>
</li>
<li><p><strong>memberOf | not memberOf语法结构</strong></p>
<p>  Object(field memberOf value[Collection&#x2F;Array])</p>
<p>  Object(field not memberOf value[Collection&#x2F;Array])</p>
</li>
<li><p><strong>matches | not matches语法结构</strong></p>
<p>  Object(field matches “正则表达式”)</p>
<p>  Object(field not matches “正则表达式”)</p>
</li>
</ul>
<h4 id="4-5-2-操作步骤"><a href="#4-5-2-操作步骤" class="headerlink" title="4.5.2 操作步骤"></a>4.5.2 操作步骤</h4><p>第一步：创建实体类，用于测试比较操作符</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>.<span class="property">entity</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">List</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实体类</span></span><br><span class="line"><span class="comment"> * 用于测试比较操作符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComparisonOperatorEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> names;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getNames</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> names;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setNames</span>(<span class="params"><span class="built_in">String</span> names</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">names</span> = names;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setList</span>(<span class="params">List&lt;<span class="built_in">String</span>&gt; list</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">list</span> = list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：在&#x2F;resources&#x2F;rules下创建规则文件comparisonOperator.drl</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package comparisonOperator</span><br><span class="line">import com.itheima.drools.entity.ComparisonOperatorEntity</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 当前规则文件用于测试Drools提供的比较操作符</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试比较操作符contains</span></span><br><span class="line">rule <span class="string">&quot;rule_comparison_contains&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">contains</span> <span class="string">&quot;张三&quot;</span>)</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">list</span> <span class="params">contains</span> <span class="params">names</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_contains触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试比较操作符not contains</span></span><br><span class="line">rule <span class="string">&quot;rule_comparison_notContains&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">not</span> <span class="params">contains</span> <span class="string">&quot;张三&quot;</span>)</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">list</span> <span class="params">not</span> <span class="params">contains</span> <span class="params">names</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_notContains触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试比较操作符memberOf</span></span><br><span class="line">rule <span class="string">&quot;rule_comparison_memberOf&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">memberOf</span> <span class="params">list</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_memberOf触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试比较操作符not memberOf</span></span><br><span class="line">rule <span class="string">&quot;rule_comparison_notMemberOf&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">not</span> <span class="params">memberOf</span> <span class="params">list</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_notMemberOf触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试比较操作符matches</span></span><br><span class="line">rule <span class="string">&quot;rule_comparison_matches&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">matches</span> <span class="string">&quot;张.*&quot;</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_matches触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试比较操作符not matches</span></span><br><span class="line">rule <span class="string">&quot;rule_comparison_notMatches&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">not</span> <span class="params">matches</span> <span class="string">&quot;张.*&quot;</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_notMatches触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第三步：编写单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//测试比较操作符</span></span><br><span class="line">@Test</span><br><span class="line">public void test3<span class="literal">()</span>&#123;</span><br><span class="line">    KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">    KieContainer kieClasspathContainer = kieServices.get<span class="constructor">KieClasspathContainer()</span>;</span><br><span class="line">    KieSession kieSession = kieClasspathContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line"></span><br><span class="line">    ComparisonOperatorEntity comparisonOperatorEntity = <span class="keyword">new</span> <span class="constructor">ComparisonOperatorEntity()</span>;</span><br><span class="line">    comparisonOperatorEntity.set<span class="constructor">Names(<span class="string">&quot;张三&quot;</span>)</span>;</span><br><span class="line">    List&lt;String&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;String&gt;<span class="literal">()</span>;</span><br><span class="line">    <span class="built_in">list</span>.add(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    <span class="built_in">list</span>.add(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    comparisonOperatorEntity.set<span class="constructor">List(<span class="params">list</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将数据提供给规则引擎，规则引擎会根据提供的数据进行规则匹配，如果规则匹配成功则执行规则</span></span><br><span class="line">    kieSession.insert(comparisonOperatorEntity);</span><br><span class="line"></span><br><span class="line">    kieSession.fire<span class="constructor">AllRules()</span>;</span><br><span class="line">    kieSession.dispose<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-执行指定规则"><a href="#4-6-执行指定规则" class="headerlink" title="4.6 执行指定规则"></a>4.6 执行指定规则</h3><p>通过前面的案例可以看到，我们在调用规则代码时，满足条件的规则都会被执行。那么如果我们只想执行其中的某个规则如何实现呢？</p>
<p>Drools给我们提供的方式是通过规则过滤器来实现执行指定规则。对于规则文件不用做任何修改，只需要修改Java代码即可，如下：</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">ComparisonOperatorEntity comparisonOperatorEntity <span class="operator">=</span> new ComparisonOperatorEntity()<span class="comment">;</span></span><br><span class="line">comparisonOperatorEntity.setNames(<span class="string">&quot;张三&quot;</span>)<span class="comment">;</span></span><br><span class="line">List&lt;String&gt; list <span class="operator">=</span> new ArrayList&lt;String&gt;()<span class="comment">;</span></span><br><span class="line">list.add(<span class="string">&quot;张三&quot;</span>)<span class="comment">;</span></span><br><span class="line">list.add(<span class="string">&quot;李四&quot;</span>)<span class="comment">;</span></span><br><span class="line">comparisonOperatorEntity.setList(list)<span class="comment">;</span></span><br><span class="line">kieSession.insert(comparisonOperatorEntity)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//通过规则过滤器实现只执行指定规则</span><br><span class="line">kieSession.fireAllRules(new RuleNameEqualsAgendaFilter(<span class="string">&quot;rule_comparison_memberOf&quot;</span>))<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-7-关键字"><a href="#4-7-关键字" class="headerlink" title="4.7 关键字"></a>4.7 关键字</h3><p>Drools的关键字分为：硬关键字(Hard keywords)和软关键字(Soft keywords)。</p>
<p>硬关键字是我们在规则文件中定义包名或者规则名时明确不能使用的，否则程序会报错。软关键字虽然可以使用，但是不建议使用。</p>
<p>硬关键字包括：true false null</p>
<p>软关键字包括：</p>
<ul>
<li>lock-on-active </li>
<li>date-effective </li>
<li>date-expires</li>
<li>no-loop </li>
<li>auto-focus</li>
<li>activation-group</li>
<li>agenda-group</li>
<li>ruleflow-group</li>
<li>entry-point</li>
<li>duration</li>
<li>package</li>
<li>import</li>
<li>dialect</li>
<li>salience</li>
<li>enabled</li>
<li>attributes</li>
<li>rule</li>
<li>extend</li>
<li>when</li>
<li>then</li>
<li>template</li>
<li>query</li>
<li>declare</li>
<li>function</li>
<li>global</li>
<li>eval</li>
<li>not</li>
<li>in</li>
<li>or</li>
<li>and</li>
<li>exists</li>
<li>forall</li>
<li>accumulate</li>
<li>collect</li>
<li>from</li>
<li>actio</li>
<li>reverse</li>
<li>result</li>
<li>end</li>
<li>over</li>
<li>init</li>
</ul>
<h3 id="4-8-Drools内置方法"><a href="#4-8-Drools内置方法" class="headerlink" title="4.8 Drools内置方法"></a>4.8 Drools内置方法</h3><p>规则文件的<code>RHS</code>部分的主要作用是通过插入，删除或修改工作内存中的Fact数据，来达到控制规则引擎执行的目的。Drools提供了一些方法可以用来操作工作内存中的数据，操作完成后规则引擎会重新进行相关规则的匹配，原来没有匹配成功的规则在我们修改数据完成后有可能就会匹配成功了。</p>
<p>创建如下实体类：</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学生</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setId</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setName</span><span class="params">(<span class="type">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setAge</span><span class="params">(<span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-8-1-update方法"><a href="#4-8-1-update方法" class="headerlink" title="4.8.1 update方法"></a>4.8.1 update方法</h4><p>update方法的作用是更新工作内存中的数据，并让相关的规则重新匹配。</p>
<p>第一步：编写规则文件&#x2F;resources&#x2F;rules&#x2F;student.drl，文件内容如下</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package student</span><br><span class="line">import com.itheima.drools.entity.Student</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 当前规则文件用于测试Drools提供的内置方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age小于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &lt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $s.set<span class="constructor">Age(15)</span>;</span><br><span class="line">        update($s);<span class="comment">//更新数据，导致相关的规则会重新匹配</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age小于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age小于20岁同时大于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &lt; 20 <span class="operator">&amp;&amp;</span> <span class="params">age</span> &gt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $s.set<span class="constructor">Age(25)</span>;</span><br><span class="line">        update($s);<span class="comment">//更新数据，导致相关的规则会重新匹配</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age小于20岁同时大于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age大于20岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &gt; 20)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age大于20岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Student student <span class="operator">=</span> new Student()<span class="comment">;</span></span><br><span class="line">student.setAge(<span class="number">5</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//将数据提供给规则引擎，规则引擎会根据提供的数据进行规则匹配，如果规则匹配成功则执行规则</span><br><span class="line">kieSession.insert(student)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台的输出可以看到规则文件中定义的三个规则都触发了。</p>
<p>在更新数据时需要注意防止发生死循环。</p>
<h4 id="4-8-2-insert方法"><a href="#4-8-2-insert方法" class="headerlink" title="4.8.2 insert方法"></a>4.8.2 insert方法</h4><p>insert方法的作用是向工作内存中插入数据，并让相关的规则重新匹配。</p>
<p>第一步：修改student.drl文件内容如下</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package student</span><br><span class="line">import com.itheima.drools.entity.Student</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 当前规则文件用于测试Drools提供的内置方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age等于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> <span class="operator">==</span> 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        Student student = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">        student.set<span class="constructor">Age(5)</span>;</span><br><span class="line">        insert(student);<span class="comment">//插入数据，导致相关的规则会重新匹配</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age等于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age小于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &lt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $s.set<span class="constructor">Age(15)</span>;</span><br><span class="line">        update($s);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age小于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age小于20岁同时大于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &lt; 20 <span class="operator">&amp;&amp;</span> <span class="params">age</span> &gt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $s.set<span class="constructor">Age(25)</span>;</span><br><span class="line">        update($s);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age小于20岁同时大于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age大于20岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &gt; 20)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age大于20岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Student student <span class="operator">=</span> new Student()<span class="comment">;</span></span><br><span class="line">student.setAge(<span class="number">10</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//将数据提供给规则引擎，规则引擎会根据提供的数据进行规则匹配，如果规则匹配成功则执行规则</span><br><span class="line">kieSession.insert(student)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台输出可以发现，四个规则都触发了，这是因为首先进行规则匹配时只有第一个规则可以匹配成功，但是在第一个规则中向工作内存中插入了一个数据导致重新进行规则匹配，此时第二个规则可以匹配成功。在第二个规则中进行了数据修改导致第三个规则也可以匹配成功，以此类推最终四个规则都匹配成功并执行了。</p>
<h4 id="4-8-3-retract方法"><a href="#4-8-3-retract方法" class="headerlink" title="4.8.3 retract方法"></a>4.8.3 retract方法</h4><p>retract方法的作用是删除工作内存中的数据，并让相关的规则重新匹配。</p>
<p>第一步：修改student.drl文件内容如下</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package student</span><br><span class="line">import com.itheima.drools.entity.Student</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 当前规则文件用于测试Drools提供的内置方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age等于10岁时删除数据&quot;</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    salience：设置当前规则的执行优先级，数值越大越优先执行，默认值为0.</span></span><br><span class="line"><span class="comment">    因为当前规则的匹配条件和下面规则的匹配条件相同，为了保证先执行当前规则，需要设置优先级</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    salience <span class="number">100</span> </span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> <span class="operator">==</span> 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        retract($s);<span class="comment">//retract方法的作用是删除工作内存中的数据，并让相关的规则重新匹配。</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age等于10岁时删除数据触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age等于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> <span class="operator">==</span> 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        Student student = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">        student.set<span class="constructor">Age(5)</span>;</span><br><span class="line">        insert(student);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age等于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age小于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &lt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $s.set<span class="constructor">Age(15)</span>;</span><br><span class="line">        update($s);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age小于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age小于20岁同时大于10岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &lt; 20 <span class="operator">&amp;&amp;</span> <span class="params">age</span> &gt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $s.set<span class="constructor">Age(25)</span>;</span><br><span class="line">        update($s);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age小于20岁同时大于10岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_student_age大于20岁&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $s:<span class="constructor">Student(<span class="params">age</span> &gt; 20)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_student_age大于20岁触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Student student <span class="operator">=</span> new Student()<span class="comment">;</span></span><br><span class="line">student.setAge(<span class="number">10</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//将数据提供给规则引擎，规则引擎会根据提供的数据进行规则匹配，如果规则匹配成功则执行规则</span><br><span class="line">kieSession.insert(student)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台输出可以发现，只有第一个规则触发了，因为在第一个规则中将工作内存中的数据删除了导致第二个规则并没有匹配成功。</p>
<h2 id="5-规则属性"><a href="#5-规则属性" class="headerlink" title="5. 规则属性"></a>5. 规则属性</h2><p>前面我们已经知道了规则体的构成如下：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rule</span> &quot;ruleName&quot;</span><br><span class="line">    attributes</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        LHS</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        RHS</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>本章节就是针对规则体的<strong>attributes</strong>属性部分进行讲解。Drools中提供的属性如下表(部分属性)：</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">salience</td>
<td align="left">指定规则执行优先级</td>
</tr>
<tr>
<td align="left">dialect</td>
<td align="left">指定规则使用的语言类型，取值为java和mvel</td>
</tr>
<tr>
<td align="left">enabled</td>
<td align="left">指定规则是否启用</td>
</tr>
<tr>
<td align="left">date-effective</td>
<td align="left">指定规则生效时间</td>
</tr>
<tr>
<td align="left">date-expires</td>
<td align="left">指定规则失效时间</td>
</tr>
<tr>
<td align="left">activation-group</td>
<td align="left">激活分组，具有相同分组名称的规则只能有一个规则触发</td>
</tr>
<tr>
<td align="left">agenda-group</td>
<td align="left">议程分组，只有获取焦点的组中的规则才有可能触发</td>
</tr>
<tr>
<td align="left">timer</td>
<td align="left">定时器，指定规则触发的时间</td>
</tr>
<tr>
<td align="left">auto-focus</td>
<td align="left">自动获取焦点，一般结合agenda-group一起使用</td>
</tr>
<tr>
<td align="left">no-loop</td>
<td align="left">防止死循环</td>
</tr>
</tbody></table>
<h3 id="5-1-enabled属性"><a href="#5-1-enabled属性" class="headerlink" title="5.1 enabled属性"></a>5.1 enabled属性</h3><p>enabled属性对应的取值为true和false，默认值为true。</p>
<p>用于指定当前规则是否启用，如果设置的值为false则当前规则无论是否匹配成功都不会触发。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">rule <span class="string">&quot;rule_comparison_notMemberOf&quot;</span></span><br><span class="line">    <span class="comment">//指定当前规则不可用，当前规则无论是否匹配成功都不会执行</span></span><br><span class="line">    enabled <span class="literal">false</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">ComparisonOperatorEntity(<span class="params">names</span> <span class="params">not</span> <span class="params">memberOf</span> <span class="params">list</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则rule_comparison_notMemberOf触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-dialect属性"><a href="#5-2-dialect属性" class="headerlink" title="5.2 dialect属性"></a>5.2 dialect属性</h3><p>dialect属性用于指定当前规则使用的语言类型，取值为java和mvel，默认值为java。</p>
<p>注：mvel是一种基于java语法的表达式语言。</p>
<p>mvel像正则表达式一样，有直接支持集合、数组和字符串匹配的操作符。</p>
<p>mvel还提供了用来配置和构造字符串的模板语言。</p>
<p>mvel表达式内容包括属性表达式，布尔表达式，方法调用，变量赋值，函数定义等。</p>
<h3 id="5-3-salience属性"><a href="#5-3-salience属性" class="headerlink" title="5.3 salience属性"></a>5.3 salience属性</h3><p>salience属性用于指定规则的执行优先级，取值类型为Integer。数值越大越优先执行。每个规则都有一个默认的执行顺序，如果不设置salience属性，规则体的执行顺序为由上到下。</p>
<p>可以通过创建规则文件salience.drl来测试salience属性，内容如下：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package test.salience</span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">rule</span> &quot;rule_2&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_3&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_3触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>通过控制台可以看到，由于以上三个规则没有设置salience属性，所以执行的顺序是按照规则文件中规则的顺序由上到下执行的。接下来我们修改一下文件内容：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testsalience</span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_1&quot;</span><br><span class="line">    salience <span class="number">9</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_2&quot;</span><br><span class="line">    salience <span class="number">10</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_3&quot;</span><br><span class="line">    salience <span class="number">8</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_3触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>通过控制台可以看到，规则文件执行的顺序是按照我们设置的salience值由大到小顺序执行的。</p>
<p>建议在编写规则时使用salience属性明确指定执行优先级。</p>
<h3 id="5-4-no-loop属性"><a href="#5-4-no-loop属性" class="headerlink" title="5.4 no-loop属性"></a>5.4 no-loop属性</h3><p>no-loop属性用于防止死循环，当规则通过update之类的函数修改了Fact对象时，可能使当前规则再次被激活从而导致死循环。取值类型为Boolean，默认值为false。测试步骤如下：</p>
<p>第一步：编写规则文件&#x2F;resource&#x2F;rules&#x2F;noloop.drl</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="title">testnoloop</span></span><br><span class="line">import com.itheima.drools.entity.Student</span><br><span class="line">/*</span><br><span class="line">    此规则文件用于测试no-<span class="keyword">loop</span>属性</span><br><span class="line">*/</span><br><span class="line">rule <span class="string">&quot;rule_noloop&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        // no-<span class="keyword">loop</span> <span class="literal">true</span></span><br><span class="line">        $student:Student(age == <span class="number">25</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        update($student);//注意此处执行update会导致当前规则重新被激活</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;规则rule_noloop触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Student student <span class="operator">=</span> new Student()<span class="comment">;</span></span><br><span class="line">student.setAge(<span class="number">25</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//将数据提供给规则引擎，规则引擎会根据提供的数据进行规则匹配，如果规则匹配成功则执行规则</span><br><span class="line">kieSession.insert(student)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台可以看到，由于我们没有设置no-loop属性的值，所以发生了死循环。接下来设置no-loop的值为true再次测试则不会发生死循环。</p>
<h3 id="5-5-activation-group属性"><a href="#5-5-activation-group属性" class="headerlink" title="5.5 activation-group属性"></a>5.5 activation-group属性</h3><p>activation-group属性是指激活分组，取值为String类型。具有相同分组名称的规则只能有一个规则被触发。</p>
<p>第一步：编写规则文件&#x2F;resources&#x2F;rules&#x2F;activationgroup.drl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testactivationgroup</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试activation-group属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">rule</span> &quot;rule_activationgroup_1&quot;</span><br><span class="line">    activation-<span class="keyword">group</span> &quot;mygroup&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_activationgroup_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_activationgroup_2&quot;</span><br><span class="line">    activation-<span class="keyword">group</span> &quot;mygroup&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_activationgroup_2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台可以发现，上面的两个规则因为属于同一个分组，所以只有一个触发了。同一个分组中的多个规则如果都能够匹配成功，具体哪一个最终能够被触发可以通过salience属性确定。</p>
<h3 id="5-6-agenda-group属性"><a href="#5-6-agenda-group属性" class="headerlink" title="5.6 agenda-group属性"></a>5.6 agenda-group属性</h3><p>agenda-group属性为议程分组，属于另一种可控的规则执行方式。用户可以通过设置agenda-group来控制规则的执行，只有获取焦点的组中的规则才会被触发。</p>
<p>第一步：创建规则文件&#x2F;resources&#x2F;rules&#x2F;agendagroup.drl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testagendagroup</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试agenda-group属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_1&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_2&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_3&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_2&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_3触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_4&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_2&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_4触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//设置焦点，对应agenda-group分组中的规则才可能被触发</span><br><span class="line">kieSession.getAgenda().getAgendaGroup(<span class="string">&quot;myagendagroup_1&quot;</span>).setFocus()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台可以看到，只有获取焦点的分组中的规则才会触发。与activation-group不同的是，activation-group定义的分组中只能够有一个规则可以被触发，而agenda-group分组中的多个规则都可以被触发。</p>
<h3 id="5-7-auto-focus属性"><a href="#5-7-auto-focus属性" class="headerlink" title="5.7 auto-focus属性"></a>5.7 auto-focus属性</h3><p>auto-focus属性为自动获取焦点，取值类型为Boolean，默认值为false。一般结合agenda-group属性使用，当一个议程分组未获取焦点时，可以设置auto-focus属性来控制。</p>
<p>第一步：修改&#x2F;resources&#x2F;rules&#x2F;agendagroup.drl文件内容如下</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testagendagroup</span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_1&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_2&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_3&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_2&quot;</span><br><span class="line">    auto-focus <span class="keyword">true</span> //自动获取焦点</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_3触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_agendagroup_4&quot;</span><br><span class="line">    agenda-<span class="keyword">group</span> &quot;myagendagroup_2&quot;</span><br><span class="line">    auto-focus <span class="keyword">true</span> //自动获取焦点</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_agendagroup_4触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>通过控制台可以看到，设置auto-focus属性为true的规则都触发了。</p>
<h3 id="5-8-timer属性"><a href="#5-8-timer属性" class="headerlink" title="5.8 timer属性"></a>5.8 timer属性</h3><p>timer属性可以通过定时器的方式指定规则执行的时间，使用方式有两种：</p>
<p><strong>方式一</strong>：timer (int: <initial delay> <repeat interval>?)</p>
<p>此种方式遵循java.util.Timer对象的使用方式，第一个参数表示几秒后执行，第二个参数表示每隔几秒执行一次，第二个参数为可选。</p>
<p><strong>方式二</strong>：timer(cron: <cron expression>)</p>
<p>此种方式使用标准的unix cron表达式的使用方式来定义规则执行的时间。</p>
<p>第一步：创建规则文件&#x2F;resources&#x2F;rules&#x2F;timer.drl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testtimer</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat</span><br><span class="line"><span class="keyword">import</span> java.util.Date</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试timer属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_timer_1&quot;</span><br><span class="line">    timer (<span class="number">5</span>s <span class="number">2</span>s) //含义：<span class="number">5</span>秒后触发，然后每隔<span class="number">2</span>秒触发一次</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_timer_1触发，触发时间为：&quot; + </span><br><span class="line">                         <span class="built_in">new</span> SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(<span class="built_in">new</span> <span class="type">Date</span>()));</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_timer_2&quot;</span><br><span class="line">    timer (cron:<span class="number">0</span>/<span class="number">1</span> * * * * ?) //含义：每隔<span class="number">1</span>秒触发一次</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_timer_2触发，触发时间为：&quot; + </span><br><span class="line">                         <span class="built_in">new</span> SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(<span class="built_in">new</span> <span class="type">Date</span>()));</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">final KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">new Thread(new Runnable() &#123;</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        //启动规则引擎进行规则匹配，直到调用halt方法才结束规则引擎</span><br><span class="line">        kieSession.fireUntilHalt()<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">10000</span>)<span class="comment">;</span></span><br><span class="line">//结束规则引擎</span><br><span class="line">kieSession.halt()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>注意：单元测试的代码和以前的有所不同，因为我们规则文件中使用到了timer进行定时执行，需要程序能够持续一段时间才能够看到定时器触发的效果。</p>
<h3 id="5-9-date-effective属性"><a href="#5-9-date-effective属性" class="headerlink" title="5.9 date-effective属性"></a>5.9 date-effective属性</h3><p>date-effective属性用于指定规则的生效时间，即只有当前系统时间大于等于设置的时间或者日期规则才有可能触发。默认日期格式为：dd-MMM-yyyy。用户也可以自定义日期格式。</p>
<p>第一步：编写规则文件&#x2F;resources&#x2F;rules&#x2F;dateeffective.drl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testdateeffective</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试date-effective属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_dateeffective_1&quot;</span><br><span class="line">    <span class="type">date</span>-effective &quot;2020-10-01 10:00&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_dateeffective_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置日期格式</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>set<span class="constructor">Property(<span class="string">&quot;drools.dateformat&quot;</span>,<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>)</span>;</span><br><span class="line">KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">KieContainer kieClasspathContainer = kieServices.get<span class="constructor">KieClasspathContainer()</span>;</span><br><span class="line">KieSession kieSession = kieClasspathContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line">kieSession.fire<span class="constructor">AllRules()</span>;</span><br><span class="line">kieSession.dispose<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<p>注意：上面的代码需要设置日期格式，否则我们在规则文件中写的日期格式和默认的日期格式不匹配程序会报错。</p>
<h3 id="5-10-date-expires属性"><a href="#5-10-date-expires属性" class="headerlink" title="5.10 date-expires属性"></a>5.10 date-expires属性</h3><p>date-expires属性用于指定规则的失效时间，即只有当前系统时间小于设置的时间或者日期规则才有可能触发。默认日期格式为：dd-MMM-yyyy。用户也可以自定义日期格式。</p>
<p>第一步：编写规则文件&#x2F;resource&#x2F;rules&#x2F;dateexpires.drl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testdateexpires</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试date-expires属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_dateexpires_1&quot;</span><br><span class="line">    <span class="type">date</span>-expires &quot;2019-10-01 10:00&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则rule_dateexpires_1触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置日期格式</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>set<span class="constructor">Property(<span class="string">&quot;drools.dateformat&quot;</span>,<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>)</span>;</span><br><span class="line">KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">KieContainer kieClasspathContainer = kieServices.get<span class="constructor">KieClasspathContainer()</span>;</span><br><span class="line">KieSession kieSession = kieClasspathContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line">kieSession.fire<span class="constructor">AllRules()</span>;</span><br><span class="line">kieSession.dispose<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<p>注意：上面的代码需要设置日期格式，否则我们在规则文件中写的日期格式和默认的日期格式不匹配程序会报错。</p>
<h2 id="6-Drools高级语法"><a href="#6-Drools高级语法" class="headerlink" title="6. Drools高级语法"></a>6. Drools高级语法</h2><p>前面章节我们已经知道了一套完整的规则文件内容构成如下：</p>
<table>
<thead>
<tr>
<th align="left">关键字</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">package</td>
<td align="left">包名，只限于逻辑上的管理，同一个包名下的查询或者函数可以直接调用</td>
</tr>
<tr>
<td align="left">import</td>
<td align="left">用于导入类或者静态方法</td>
</tr>
<tr>
<td align="left">global</td>
<td align="left">全局变量</td>
</tr>
<tr>
<td align="left">function</td>
<td align="left">自定义函数</td>
</tr>
<tr>
<td align="left">query</td>
<td align="left">查询</td>
</tr>
<tr>
<td align="left">rule end</td>
<td align="left">规则体</td>
</tr>
</tbody></table>
<p>本章节我们就来学习其中的几个关键字。</p>
<h3 id="6-1-global全局变量"><a href="#6-1-global全局变量" class="headerlink" title="6.1 global全局变量"></a>6.1 global全局变量</h3><p>global关键字用于在规则文件中定义全局变量，它可以让应用程序的对象在规则文件中能够被访问。可以用来为规则文件提供数据或服务。</p>
<p>语法结构为：<strong>global 对象类型 对象名称</strong></p>
<p>在使用global定义的全局变量时有两点需要注意：</p>
<p>1、如果对象类型为包装类型时，在一个规则中改变了global的值，那么只针对当前规则有效，对其他规则中的global不会有影响。可以理解为它是当前规则代码中的global副本，规则内部修改不会影响全局的使用。</p>
<p>2、如果对象类型为集合类型或JavaBean时，在一个规则中改变了global的值，对java代码和所有规则都有效。</p>
<p>下面我们通过代码进行验证：</p>
<p>第一步：创建UserService类</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">package com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserService</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;UserService.save()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：编写规则文件&#x2F;resources&#x2F;rules&#x2F;global.drl</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testglobal</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试global全局变量</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> java.lang.Integer count //定义一个包装类型的全局变量</span><br><span class="line"><span class="keyword">global</span> com.itheima.drools.service.UserService userService //定义一个JavaBean类型的全局变量</span><br><span class="line"><span class="keyword">global</span> java.util.List gList //定义一个集合类型的全局变量</span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_global_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        count += <span class="number">10</span>; //全局变量计算，只对当前规则有效，其他规则不受影响</span><br><span class="line">        userService.save();//调用全局变量的方法</span><br><span class="line">        gList.<span class="keyword">add</span>(&quot;itcast&quot;);//向集合类型的全局变量中添加元素，Java代码和所有规则都受影响</span><br><span class="line">        gList.<span class="keyword">add</span>(&quot;itheima&quot;);</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;count=&quot; + count);</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;gList.size=&quot; + gList.size());</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;rule_global_2&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        userService.save();</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;count=&quot; + count);</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;gList.size=&quot; + gList.size());</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第三步：编写单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">KieContainer kieClasspathContainer = kieServices.get<span class="constructor">KieClasspathContainer()</span>;</span><br><span class="line">KieSession kieSession = kieClasspathContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置全局变量，名称和类型必须和规则文件中定义的全局变量名称对应</span></span><br><span class="line">kieSession.set<span class="constructor">Global(<span class="string">&quot;userService&quot;</span>,<span class="params">new</span> UserService()</span>);</span><br><span class="line">kieSession.set<span class="constructor">Global(<span class="string">&quot;count&quot;</span>,5)</span>;</span><br><span class="line">List <span class="built_in">list</span> = <span class="keyword">new</span> <span class="constructor">ArrayList()</span>;<span class="comment">//size为0</span></span><br><span class="line">kieSession.set<span class="constructor">Global(<span class="string">&quot;gList&quot;</span>,<span class="params">list</span>)</span>;</span><br><span class="line"></span><br><span class="line">kieSession.fire<span class="constructor">AllRules()</span>;</span><br><span class="line">kieSession.dispose<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//因为在规则中为全局变量添加了两个元素，所以现在的size为2</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="built_in">list</span>.size<span class="literal">()</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-2-query查询"><a href="#6-2-query查询" class="headerlink" title="6.2 query查询"></a>6.2 query查询</h3><p>query查询提供了一种<strong>查询working memory中符合约束条件的Fact对象</strong>的简单方法。它仅包含规则文件中的LHS部分，不用指定“when”和“then”部分并且以end结束。具体语法结构如下：</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">query</span> 查询的名称(可选参数)</span><br><span class="line">    LHS</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>具体操作步骤：</p>
<p>第一步：编写规则文件&#x2F;resources&#x2F;rules&#x2F;query.drl</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package testquery</span><br><span class="line">import com.itheima.drools.entity.Student</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试query查询</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//不带参数的查询</span></span><br><span class="line"><span class="comment">//当前query用于查询Working Memory中age&gt;10的Student对象</span></span><br><span class="line">query <span class="string">&quot;query_1&quot;</span></span><br><span class="line">    $student:<span class="constructor">Student(<span class="params">age</span> &gt; 10)</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//带有参数的查询</span></span><br><span class="line"><span class="comment">//当前query用于查询Working Memory中age&gt;10同时name需要和传递的参数name相同的Student对象</span></span><br><span class="line">query <span class="string">&quot;query_2&quot;</span>(String sname)</span><br><span class="line">    $student:<span class="constructor">Student(<span class="params">age</span> &gt; 20 <span class="operator">&amp;&amp;</span> <span class="params">name</span> <span class="operator">==</span> <span class="params">sname</span>)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">KieContainer kieClasspathContainer = kieServices.get<span class="constructor">KieClasspathContainer()</span>;</span><br><span class="line">KieSession kieSession = kieClasspathContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line"></span><br><span class="line">Student student1 = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">student1.set<span class="constructor">Name(<span class="string">&quot;张三&quot;</span>)</span>;</span><br><span class="line">student1.set<span class="constructor">Age(12)</span>;</span><br><span class="line"></span><br><span class="line">Student student2 = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">student2.set<span class="constructor">Name(<span class="string">&quot;李四&quot;</span>)</span>;</span><br><span class="line">student2.set<span class="constructor">Age(8)</span>;</span><br><span class="line"></span><br><span class="line">Student student3 = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">student3.set<span class="constructor">Name(<span class="string">&quot;王五&quot;</span>)</span>;</span><br><span class="line">student3.set<span class="constructor">Age(22)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将对象插入Working Memory中</span></span><br><span class="line">kieSession.insert(student1);</span><br><span class="line">kieSession.insert(student2);</span><br><span class="line">kieSession.insert(student3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用规则文件中的查询</span></span><br><span class="line">QueryResults results1 = kieSession.get<span class="constructor">QueryResults(<span class="string">&quot;query_1&quot;</span>)</span>;</span><br><span class="line"><span class="built_in">int</span> size = results1.size<span class="literal">()</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;size=&quot;</span> + size);</span><br><span class="line"><span class="keyword">for</span> (QueryResultsRow row : results1) &#123;</span><br><span class="line">    Student student = (Student) row.get(<span class="string">&quot;$student&quot;</span>);</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(student);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用规则文件中的查询</span></span><br><span class="line">QueryResults results2 = kieSession.get<span class="constructor">QueryResults(<span class="string">&quot;query_2&quot;</span>,<span class="string">&quot;王五&quot;</span>)</span>;</span><br><span class="line">size = results2.size<span class="literal">()</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;size=&quot;</span> + size);</span><br><span class="line"><span class="keyword">for</span> (QueryResultsRow row : results2) &#123;</span><br><span class="line">    Student student = (Student) row.get(<span class="string">&quot;$student&quot;</span>);</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(student);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//kieSession.fireAllRules();</span></span><br><span class="line">kieSession.dispose<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-function函数"><a href="#6-3-function函数" class="headerlink" title="6.3 function函数"></a>6.3 function函数</h3><p>function关键字用于在规则文件中定义函数，就相当于java类中的方法一样。可以在规则体中调用定义的函数。使用函数的好处是可以将业务逻辑集中放置在一个地方，根据需要可以对函数进行修改。</p>
<p>函数定义的语法结构如下：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> 返回值类型 函数名(<span class="params">可选参数</span>)&#123;</span><br><span class="line">    <span class="comment">//逻辑代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体操作步骤：</p>
<p>第一步：编写规则文件&#x2F;resources&#x2F;rules&#x2F;function.drl</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package testfunction</span><br><span class="line">import com.itheima.drools.entity.Student</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    此规则文件用于测试function函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个函数</span></span><br><span class="line"><span class="keyword">function</span> String say<span class="constructor">Hello(String <span class="params">name</span>)</span>&#123;</span><br><span class="line">    return <span class="string">&quot;hello &quot;</span> + name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_function_1&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $student:<span class="constructor">Student(<span class="params">name</span> != <span class="params">null</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="comment">//调用上面定义的函数</span></span><br><span class="line">        String ret = say<span class="constructor">Hello($<span class="params">student</span>.<span class="params">getName</span>()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(ret);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第二步：编写单元测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">KieServices kieServices <span class="operator">=</span> KieServices.Factory.get()<span class="comment">;</span></span><br><span class="line">KieContainer kieClasspathContainer <span class="operator">=</span> kieServices.getKieClasspathContainer()<span class="comment">;</span></span><br><span class="line">KieSession kieSession <span class="operator">=</span> kieClasspathContainer.newKieSession()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">Student student <span class="operator">=</span> new Student()<span class="comment">;</span></span><br><span class="line">student.setName(<span class="string">&quot;小明&quot;</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.insert(student)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">kieSession.fireAllRules()<span class="comment">;</span></span><br><span class="line">kieSession.dispose()<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-LHS加强"><a href="#6-4-LHS加强" class="headerlink" title="6.4 LHS加强"></a>6.4 LHS加强</h3><p>前面我们已经知道了在规则体中的LHS部分是介于when和then之间的部分，主要用于模式匹配，只有匹配结果为true时，才会触发RHS部分的执行。本章节我们会针对LHS部分学习几个新的用法。</p>
<h4 id="6-4-1-复合值限制in-x2F-not-in"><a href="#6-4-1-复合值限制in-x2F-not-in" class="headerlink" title="6.4.1 复合值限制in&#x2F;not in"></a>6.4.1 复合值限制in&#x2F;not in</h4><p>复合值限制是指超过一种匹配值的限制条件，类似于SQL语句中的in关键字。Drools规则体中的LHS部分可以使用in或者not in进行复合值的匹配。具体语法结构如下：</p>
<p><strong>Object(field in (比较值1,比较值2…))</strong></p>
<p>举例：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">$s:<span class="constructor">Student(<span class="params">name</span> <span class="params">in</span> (<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>)</span>)</span><br><span class="line">$s:<span class="constructor">Student(<span class="params">name</span> <span class="params">not</span> <span class="params">in</span> (<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>)</span>)</span><br></pre></td></tr></table></figure>

<h4 id="6-4-2-条件元素eval"><a href="#6-4-2-条件元素eval" class="headerlink" title="6.4.2 条件元素eval"></a>6.4.2 条件元素eval</h4><p>eval用于规则体的LHS部分，并返回一个Boolean类型的值。语法结构如下：</p>
<p><strong>eval(表达式)</strong></p>
<p>举例：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">eval</span><span class="params">(true)</span></span></span><br><span class="line"><span class="function"><span class="title">eval</span><span class="params">(false)</span></span></span><br><span class="line"><span class="function"><span class="title">eval</span><span class="params">(<span class="number">1</span> == <span class="number">1</span>)</span></span></span><br></pre></td></tr></table></figure>

<h4 id="6-4-3-条件元素not"><a href="#6-4-3-条件元素not" class="headerlink" title="6.4.3 条件元素not"></a>6.4.3 条件元素not</h4><p>not用于判断Working Memory中是否存在某个Fact对象，如果不存在则返回true，如果存在则返回false。语法结构如下：</p>
<p><strong>not Object(可选属性约束)</strong></p>
<p>举例：</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">not</span></span> <span class="function"><span class="title">Student</span>()</span></span><br><span class="line"><span class="variable"><span class="keyword">not</span></span> <span class="function"><span class="title">Student</span>(<span class="variable">age</span> &lt; <span class="number">10</span>)</span></span><br></pre></td></tr></table></figure>

<h4 id="6-4-4-条件元素exists"><a href="#6-4-4-条件元素exists" class="headerlink" title="6.4.4 条件元素exists"></a>6.4.4 条件元素exists</h4><p>exists的作用与not相反，用于判断Working Memory中是否存在某个Fact对象，如果存在则返回true，不存在则返回false。语法结构如下：</p>
<p><strong>exists Object(可选属性约束)</strong></p>
<p>举例：</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">exists</span> <span class="function"><span class="title">Student</span>()</span></span><br><span class="line"><span class="variable">exists</span> <span class="function"><span class="title">Student</span>(<span class="variable">age</span> &lt; <span class="number">10</span> &amp;&amp; <span class="variable">name</span> <span class="variable">!</span>= <span class="variable"><span class="literal">null</span></span>)</span></span><br></pre></td></tr></table></figure>

<p>可能有人会有疑问，我们前面在LHS部分进行条件编写时并没有使用exists也可以达到判断Working Memory中是否存在某个符合条件的Fact元素的目的，那么我们使用exists还有什么意义？</p>
<p>两者的区别：当向Working Memory中加入多个满足条件的Fact对象时，使用了exists的规则执行一次，不使用exists的规则会执行多次。</p>
<p>例如：</p>
<p>规则文件(只有规则体)：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rule</span> &quot;使用exists的规则&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="keyword">exists</span> Student()</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则：使用exists的规则触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rule</span> &quot;没有使用exists的规则&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        Student()</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则：没有使用exists的规则触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Java代码：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">kieSession.insert(<span class="keyword">new</span> <span class="constructor">Student()</span>);</span><br><span class="line">kieSession.insert(<span class="keyword">new</span> <span class="constructor">Student()</span>);</span><br><span class="line">kieSession.fire<span class="constructor">AllRules()</span>;</span><br></pre></td></tr></table></figure>

<p>上面第一个规则只会执行一次，因为Working Memory中存在两个满足条件的Fact对象，第二个规则会执行两次。</p>
<h4 id="6-4-5-规则继承"><a href="#6-4-5-规则继承" class="headerlink" title="6.4.5 规则继承"></a>6.4.5 规则继承</h4><p>规则之间可以使用extends关键字进行规则条件部分的继承，类似于java类之间的继承。</p>
<p>例如：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">rule <span class="string">&quot;rule_1&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="constructor">Student(<span class="params">age</span> &gt; 10)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则：rule_1触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_2&quot;</span> extends <span class="string">&quot;rule_1&quot;</span> <span class="comment">//继承上面的规则</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        此处的条件虽然只写了一个，但是从上面的规则继承了一个条件，</span></span><br><span class="line"><span class="comment">        所以当前规则存在两个条件，即Student(age &lt; 20)和Student(age &gt; 10)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="constructor">Student(<span class="params">age</span> &lt; 20)</span> </span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;规则：rule_2触发&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-RHS加强"><a href="#6-5-RHS加强" class="headerlink" title="6.5 RHS加强"></a>6.5 RHS加强</h3><p>RHS部分是规则体的重要组成部分，当LHS部分的条件匹配成功后，对应的RHS部分就会触发执行。一般在RHS部分中需要进行业务处理。</p>
<p>在RHS部分Drools为我们提供了一个内置对象，名称就是drools。本小节我们来介绍几个drools对象提供的方法。</p>
<h4 id="6-5-1-halt"><a href="#6-5-1-halt" class="headerlink" title="6.5.1 halt"></a>6.5.1 halt</h4><p>halt方法的作用是立即终止后面所有规则的执行。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">package testhalt</span><br><span class="line"><span class="keyword">rule</span> &quot;rule_halt_1&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则：rule_halt_1触发&quot;);</span><br><span class="line">        drools.halt();//立即终止后面所有规则执行</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">//当前规则并不会触发，因为上面的规则调用了halt方法导致后面所有规则都不会执行</span><br><span class="line"><span class="keyword">rule</span> &quot;rule_halt_2&quot;</span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;规则：rule_halt_2触发&quot;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="6-5-2-getWorkingMemory"><a href="#6-5-2-getWorkingMemory" class="headerlink" title="6.5.2 getWorkingMemory"></a>6.5.2 getWorkingMemory</h4><p>getWorkingMemory方法的作用是返回工作内存对象。</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="title">testgetWorkingMemory</span></span><br><span class="line">rule <span class="string">&quot;rule_getWorkingMemory&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(drools.getWorkingMemory());</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="6-5-3-getRule"><a href="#6-5-3-getRule" class="headerlink" title="6.5.3 getRule"></a>6.5.3 getRule</h4><p>getRule方法的作用是返回规则对象。</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="title">testgetRule</span></span><br><span class="line">rule <span class="string">&quot;rule_getRule&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(drools.getRule());</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="6-6-规则文件编码规范"><a href="#6-6-规则文件编码规范" class="headerlink" title="6.6 规则文件编码规范"></a>6.6 规则文件编码规范</h3><p>我们在进行drl类型的规则文件编写时尽量遵循如下规范：</p>
<ul>
<li>所有的规则文件(.drl)应统一放在一个规定的文件夹中，如：&#x2F;rules文件夹</li>
<li>书写的每个规则应尽量加上注释。注释要清晰明了，言简意赅</li>
<li>同一类型的对象尽量放在一个规则文件中，如所有Student类型的对象尽量放在一个规则文件中</li>
<li>规则结果部分(RHS)尽量不要有条件语句，如if(…)，尽量不要有复杂的逻辑和深层次的嵌套语句</li>
<li>每个规则最好都加上salience属性，明确执行顺序</li>
<li>Drools默认dialect为”Java”，尽量避免使用dialect “mvel”</li>
</ul>
<h2 id="7-Spring整合Drools"><a href="#7-Spring整合Drools" class="headerlink" title="7. Spring整合Drools"></a>7. Spring整合Drools</h2><h3 id="7-1-Spring简单整合Drools"><a href="#7-1-Spring简单整合Drools" class="headerlink" title="7.1 Spring简单整合Drools"></a>7.1 Spring简单整合Drools</h3><p>在项目中使用Drools时往往会跟Spring整合来使用。具体整合步骤如下：</p>
<p>第一步：创建maven工程drools_spring并配置pom.xml</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools_spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">drools.version</span>&gt;</span>7.10.0.Final<span class="tag">&lt;/<span class="name">drools.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;drools.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;drools.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--注意：此处必须排除传递过来的依赖，否则会跟我们自己导入的Spring jar包产生冲突--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：创建规则目录&#x2F;resources&#x2F;rules，中rules目录中创建规则文件helloworld.drl</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="title">helloworld</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_helloworld&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;规则：rule_helloworld触发...&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第三步：创建Spring配置文件&#x2F;resources&#x2F;spring.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:kie</span>=<span class="string">&quot;http://drools.org/schema/kie-spring&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://drools.org/schema/kie-spring</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://drools.org/schema/kie-spring.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kie:kmodule</span> <span class="attr">id</span>=<span class="string">&quot;kmodule&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">kie:kbase</span> <span class="attr">name</span>=<span class="string">&quot;kbase&quot;</span> <span class="attr">packages</span>=<span class="string">&quot;rules&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">kie:ksession</span> <span class="attr">name</span>=<span class="string">&quot;ksession&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">kie:ksession</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">kie:kbase</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">kie:kmodule</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.kie.spring.annotations.KModuleAnnotationPostProcessor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第四步：编写单元测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.cdi.KBase;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:spring.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsSpringTest</span> &#123;</span><br><span class="line">    <span class="meta">@KBase(&quot;kbase&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> KieBase kieBase;<span class="comment">//注入KieBase对象</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">KieSession</span> <span class="variable">kieSession</span> <span class="operator">=</span> kieBase.newKieSession();</span><br><span class="line">        kieSession.fireAllRules();</span><br><span class="line">        kieSession.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-Spring整合Drools-web"><a href="#7-2-Spring整合Drools-web" class="headerlink" title="7.2 Spring整合Drools+web"></a>7.2 Spring整合Drools+web</h3><p>本小节我们来进行Drools和Spring Web的整合。具体操作步骤如下：</p>
<p>第一步：创建maven的war工程drools_springweb并在pom.xml文件中导入相关maven坐标</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools_springweb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">drools.version</span>&gt;</span>7.10.0.Final<span class="tag">&lt;/<span class="name">drools.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;drools.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;drools.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--注意：此处必须排除传递过来的依赖，否则会跟我们自己导入的Spring jar包产生冲突--&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="comment">&lt;!-- 指定端口 --&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>80<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="comment">&lt;!-- 请求路径 --&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：配置web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三步：创建&#x2F;resources&#x2F;springmvc.xml文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:kie</span>=<span class="string">&quot;http://drools.org/schema/kie-spring&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://drools.org/schema/kie-spring</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://drools.org/schema/kie-spring.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">kie:kmodule</span> <span class="attr">id</span>=<span class="string">&quot;kmodule&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">kie:kbase</span> <span class="attr">name</span>=<span class="string">&quot;kbase&quot;</span> <span class="attr">packages</span>=<span class="string">&quot;rules&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">kie:ksession</span> <span class="attr">name</span>=<span class="string">&quot;ksession&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">kie:ksession</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">kie:kbase</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">kie:kmodule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.kie.spring.annotations.KModuleAnnotationPostProcessor&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring批量扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springMVC注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第四步：创建规则文件&#x2F;resources&#x2F;rules&#x2F;helloworld.drl</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="title">helloworld</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;rule_helloworld&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;规则：rule_helloworld触发...&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第五步：创建RuleService</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.cdi.KBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleService</span> &#123;</span><br><span class="line">    <span class="meta">@KBase(&quot;kbase&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> KieBase kieBase;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">KieSession</span> <span class="variable">kieSession</span> <span class="operator">=</span> kieBase.newKieSession();</span><br><span class="line">        kieSession.fireAllRules();</span><br><span class="line">        kieSession.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第六步：创建HelloController</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.RuleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/hello&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleService ruleService;</span><br><span class="line">    <span class="meta">@RequestMapping(<span class="string">&quot;/rule&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String rule()&#123;</span><br><span class="line">        ruleService.rule();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-Spring-Boot整合Drools"><a href="#7-3-Spring-Boot整合Drools" class="headerlink" title="7.3 Spring Boot整合Drools"></a>7.3 Spring Boot整合Drools</h3><p>目前在企业开发中Spring Boot已经成为主流，本小节我们来进行Spring Boot整合Drools。具体操作步骤：</p>
<p>第一步：创建maven工程drools_springboot并配置pom.xml</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starters<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools_springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--drools规则引擎--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-templates<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$</span><span class="template-variable">&#123;project.artifactId&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：创建&#x2F;resources&#x2F;application.yml文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">drools_springboot</span></span><br></pre></td></tr></table></figure>

<p>第三步：创建规则文件&#x2F;resources&#x2F;rules&#x2F;helloworld.drl</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="title">helloworld</span></span><br><span class="line">rule <span class="string">&quot;rule_helloworld&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        eval(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;规则：rule_helloworld触发...&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第四步：编写配置类DroolsConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.config;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieServices;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieBuilder;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieFileSystem;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieRepository;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieContainer;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.kie.internal.io.ResourceFactory;</span><br><span class="line"><span class="keyword">import</span> org.kie.spring.KModuleBeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 规则引擎配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsConfig</span> &#123;</span><br><span class="line">    <span class="comment">//指定规则文件存放的目录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RULES_PATH</span> <span class="operator">=</span> <span class="string">&quot;rules/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">KieServices</span> <span class="variable">kieServices</span> <span class="operator">=</span> KieServices.Factory.get();</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieFileSystem <span class="title function_">kieFileSystem</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">KieFileSystem</span> <span class="variable">kieFileSystem</span> <span class="operator">=</span> kieServices.newKieFileSystem();</span><br><span class="line">        <span class="type">ResourcePatternResolver</span> <span class="variable">resourcePatternResolver</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">        Resource[] files = </span><br><span class="line">            resourcePatternResolver.getResources(<span class="string">&quot;classpath*:&quot;</span> + RULES_PATH + <span class="string">&quot;*.*&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Resource file : files) &#123;</span><br><span class="line">            path = RULES_PATH + file.getFilename();</span><br><span class="line">            kieFileSystem.write(ResourceFactory.newClassPathResource(path, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> kieFileSystem;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieContainer <span class="title function_">kieContainer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">KieRepository</span> <span class="variable">kieRepository</span> <span class="operator">=</span> kieServices.getRepository();</span><br><span class="line">        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);</span><br><span class="line">        <span class="type">KieBuilder</span> <span class="variable">kieBuilder</span> <span class="operator">=</span> kieServices.newKieBuilder(kieFileSystem());</span><br><span class="line">        kieBuilder.buildAll();</span><br><span class="line">        <span class="keyword">return</span> kieServices.newKieContainer(kieRepository.getDefaultReleaseId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieBase <span class="title function_">kieBase</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> kieContainer().getKieBase();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KModuleBeanFactoryPostProcessor <span class="title function_">kiePostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KModuleBeanFactoryPostProcessor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五步：创建RuleService类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KieBase kieBase;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">KieSession</span> <span class="variable">kieSession</span> <span class="operator">=</span> kieBase.newKieSession();</span><br><span class="line">        kieSession.fireAllRules();</span><br><span class="line">        kieSession.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第六步：创建HelloController类</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.service.RuleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/hello&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleService ruleService;</span><br><span class="line">    <span class="meta">@RequestMapping(<span class="string">&quot;/rule&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> String rule()&#123;</span><br><span class="line">        ruleService.rule();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建启动类DroolsApplication</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">SpringApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">autoconfigure</span>.<span class="property">SpringBootApplication</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">SpringApplication</span>.<span class="title function_">run</span>(<span class="title class_">DroolsApplication</span>.<span class="property">class</span>,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：启动服务，访问<a href="http://localhost:8080/hello/rule">http://localhost:8080/hello/rule</a></p>
<h2 id="8-WorkBench"><a href="#8-WorkBench" class="headerlink" title="8. WorkBench"></a>8. WorkBench</h2><h3 id="8-1-WorkBench简介"><a href="#8-1-WorkBench简介" class="headerlink" title="8.1 WorkBench简介"></a>8.1 WorkBench简介</h3><p>WorkBench是KIE组件中的元素，也称为KIE-WB，是Drools-WB与JBPM-WB的结合体。它是一个可视化的规则编辑器。WorkBench其实就是一个war包，安装到tomcat中就可以运行。使用WorkBench可以在浏览器中创建数据对象、创建规则文件、创建测试场景并将规则部署到maven仓库供其他应用使用。</p>
<p>下载地址：<a href="https://download.jboss.org/drools/release/7.6.0.Final/kie-drools-wb-7.6.0.Final-tomcat8.war">https://download.jboss.org/drools/release/7.6.0.Final/kie-drools-wb-7.6.0.Final-tomcat8.war</a></p>
<p>注意：下载的war包需要安装到tomcat8中。</p>
<h3 id="8-2-安装方式"><a href="#8-2-安装方式" class="headerlink" title="8.2 安装方式"></a>8.2 安装方式</h3><p>软件安装时经常会涉及到软件版本兼容性的问题，所以需要明确各个软件的使用版本。</p>
<p>本课程使用的软件环境如下：</p>
<ul>
<li>操作系统：Windows 10 64位</li>
<li>JDK版本：1.8</li>
<li>maven版本：3.5.4</li>
<li>Tomcat版本：8.5</li>
</ul>
<p>具体安装步骤：</p>
<p>第一步：配置Tomcat的环境变量CATALINA_HOME，对应的值为Tomcat安装目录</p>
<p>第二步：在Tomcat的bin目录下创建setenv.bat文件，内容如下：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">CATALINA_OPTS</span>=<span class="string">&quot;-Xmx512M \</span></span><br><span class="line"><span class="string">    -Djava.security.auth.login.config=$CATALINA_HOME/webapps/kie-drools-wb/WEB-INF/classes/login.config \</span></span><br><span class="line"><span class="string">    -Dorg.jboss.logging.provider=jdk&quot;</span></span><br></pre></td></tr></table></figure>

<p>第三步：将下载的WorkBench的war包改名为kie-drools-wb.war并复制到Tomcat的webapps目录下</p>
<p>第四步：修改Tomcat下conf&#x2F;tomcat-users.xml文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://tomcat.apache.org/xml&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--定义admin角色--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--定义一个用户，用户名为kie，密码为kie，对应的角色为admin角色--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;kie&quot;</span> <span class="attr">password</span>=<span class="string">&quot;kie&quot;</span> <span class="attr">roles</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第五步：下载以下三个jar包并复制到Tomcat的lib目录下</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kie</span>-tomcat-integration-<span class="number">7</span>.<span class="number">10</span>.<span class="number">0</span>.Final.jar</span><br><span class="line"><span class="attribute">javax</span>.security.jacc-api-<span class="number">1</span>.<span class="number">5</span>.jar</span><br><span class="line"><span class="attribute">slf4j</span>-api-<span class="number">1</span>.<span class="number">7</span>.<span class="number">25</span>.jar</span><br></pre></td></tr></table></figure>

<p>第六步：修改Tomcat的conf&#x2F;server.xml文件，添加Valve标签，内容为：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Valve <span class="attribute">className</span>=<span class="string">&quot;org.kie.integration.tomcat.JACCValve&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>第七步：启动Tomcat并访问<a href="http://localhost:8080/kie-drools-wb%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0WorkBench%E7%9A%84%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E3%80%82%E4%BD%BF%E7%94%A8%E5%89%8D%E9%9D%A2%E5%9C%A8tomcat-users.xml%E6%96%87%E4%BB%B6%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E7%94%A8%E6%88%B7%E8%BF%9B%E8%A1%8C%E7%99%BB%E5%BD%95%E5%8D%B3%E5%8F%AF">http://localhost:8080/kie-drools-wb，可以看到WorkBench的登录页面。使用前面在tomcat-users.xml文件中定义的用户进行登录即可</a></p>
<p><img src="/blog/images/202103/12.png" alt="12"></p>
<p>登录成功后进入系统首页：</p>
<p><img src="/blog/images/202103/13.png" alt="13"></p>
<h3 id="8-3-使用方式"><a href="#8-3-使用方式" class="headerlink" title="8.3 使用方式"></a>8.3 使用方式</h3><h4 id="8-3-1-创建空间、项目"><a href="#8-3-1-创建空间、项目" class="headerlink" title="8.3.1 创建空间、项目"></a>8.3.1 创建空间、项目</h4><p>WorkBench中存在空间和项目的概念。我们在使用WorkBench时首先需要创建空间（Space），在空间中创建项目，在项目中创建数据对象、规则文件等。</p>
<ul>
<li><p>创建空间</p>
<p>  第一步：登录WorkBench后进行系统首页，点击首页中的Design区域进入项目列表页面：</p>
<p>  <img src="/blog/images/202103/14.png" alt="14"></p>
<p>  如果是第一次登录还没有创建项目则无法看到项目</p>
<p>  第二步：点击左上角Spaces导航链接进入空间列表页面</p>
<p>  <img src="/blog/images/202103/15.png" alt="15"></p>
<p>  第三步：点击右上角Add Space按钮弹出创建添加空间窗口</p>
<p>  <img src="/blog/images/202103/16.png" alt="16"></p>
<p>  录入空间名称，点击Save按钮则完成空间的创建，如下图：</p>
<p>  <img src="/blog/images/202103/17.png" alt="17"></p>
</li>
<li><p>创建项目</p>
<p>  前面已经提到，我们在WorkBench中需要先创建空间，在空间中才能创建项目。上面我们已经创建了一个空间itheima，现在需要住此空间中创建项目。</p>
<p>  第一步：点击itheima空间，进入此空间</p>
<p>  <img src="/blog/images/202103/18.png" alt="18"></p>
<p>  可以看到当前空间中还没有项目</p>
<p>  第二步：点击Add Project按钮弹出添加项目窗口</p>
<p>  <img src="/blog/images/202103/19.png" alt="19"></p>
<p>  第三步：在添加项目窗口中录入项目名称（例如项目名称为pro1），点击Add按钮完成操作</p>
<p>  <img src="/blog/images/202103/20.png" alt="20"></p>
<p>  可以看到在完成项目创建后，系统直接跳转到了项目页面。要查看当前itheima空间中的所有项目，可以点击左上角itheima链接：</p>
<p>  <img src="/blog/images/202103/21.png" alt="21"></p>
</li>
</ul>
<h4 id="8-3-2-创建数据对象"><a href="#8-3-2-创建数据对象" class="headerlink" title="8.3.2 创建数据对象"></a>8.3.2 创建数据对象</h4><p>数据对象其实就是JavaBean，一般都是在drl规则文件中使用进行规则匹配。</p>
<p>第一步：在itheima空间中点击pro1项目，进入此项目页面</p>
<p><img src="/blog/images/202103/22.png" alt="22"></p>
<p>第二步：点击Create New Asset按钮选择“数据对象”</p>
<p><img src="/blog/images/202103/23.png" alt="23"></p>
<p>第三步：在弹出的创建数据对象窗口中输入数据对象的名称，点击确定按钮完成操作</p>
<p><img src="/blog/images/202103/24.png" alt="24"></p>
<p>操作完成后可以看到如下：</p>
<p><img src="/blog/images/202103/25.png" alt="25"></p>
<p>第四步：点击“添加字段”按钮弹出新建字段窗口</p>
<p><img src="/blog/images/202103/26.png" alt="26"></p>
<p>第五步：在新建字段窗口中录入字段Id（其实就是属性名），选择类型，点击创建按钮完成操作</p>
<p><img src="/blog/images/202103/27.png" alt="27"></p>
<p>完成操作后可以看到刚才创建的字段：</p>
<p><img src="/blog/images/202103/28.png" alt="28"></p>
<p>可以点击添加字段按钮继续创建其他字段：</p>
<p><img src="/blog/images/202103/29.png" alt="29"></p>
<p>注意添加完字段后需要点击右上角保存按钮完成保存操作：</p>
<p><img src="/blog/images/202103/32.png" alt="32"></p>
<p>点击源代码按钮可以查看刚才创建的Person对象源码：</p>
<p><img src="/blog/images/202103/30.png" alt="30"></p>
<p>点击左上角pro1项目链接，可以看到当前pro1项目中已经创建的各种类型的对象：</p>
<p><img src="/blog/images/202103/31.png" alt="31"></p>
<h4 id="8-3-3-创建DRL规则文件"><a href="#8-3-3-创建DRL规则文件" class="headerlink" title="8.3.3 创建DRL规则文件"></a>8.3.3 创建DRL规则文件</h4><p>第一步：在pro1项目页面点击右上角Create New Asset按钮，选择“DRL文件”，弹出创建DRL文件窗口</p>
<p><img src="/blog/images/202103/33.png" alt="33"></p>
<p>第二步：在添加DRL文件窗口录入DRL文件名称，点击确定按钮完成操作</p>
<p><img src="/blog/images/202103/34.png" alt="34"></p>
<p>第三步：上面点击确定按钮完成创建DRL文件后，页面会跳转到编辑DRL文件页面</p>
<p><img src="/blog/images/202103/35.png" alt="35"></p>
<p>可以看到DRL规则文件页面分为两个部分：左侧为项目浏览视图、右侧为编辑区域，需要注意的是左侧默认展示的不是项目浏览视图，需要点击上面设置按钮，选择“资料库视图”和“显示为文件夹”，如下图所示：</p>
<p><img src="/blog/images/202103/36.png" alt="36"></p>
<p>第四步：在编辑DRL文件页面右侧区域进行DRL文件的编写，点击右上角保存按钮完成保存操作，点击检验按钮进行规则文件语法检查</p>
<p><img src="/blog/images/202103/37.png" alt="37"></p>
<p>点击左上角pro1项目回到项目页面，可以看到此项目下已经存在两个对象，即person.drl规则文件和Person类：</p>
<p><img src="/blog/images/202103/38.png" alt="38"></p>
<h4 id="8-3-4-创建测试场景"><a href="#8-3-4-创建测试场景" class="headerlink" title="8.3.4 创建测试场景"></a>8.3.4 创建测试场景</h4><p>前面我们已经创建了Person数据对象和person规则文件，现在我们需要测试一下规则文件中的规则，可以通过创建测试场景来进行测试。</p>
<p>第一步：在项目页面点击Create New Asset按钮选择“测试场景”，弹出创建测试场景窗口</p>
<p><img src="/blog/images/202103/39.png" alt="39"></p>
<p>第二步：在弹出的创建测试场景窗口中录入测试场景的名称，点击确定完成操作</p>
<p><img src="/blog/images/202103/40.png" alt="40"></p>
<p>完成测试场景的创建后，页面会跳转到测试场景编辑页面，如下图：</p>
<p><img src="/blog/images/202103/41.png" alt="41"></p>
<p>第三步：因为我们编写的规则文件中需要从工作内存中获取Person对象进行规则匹配，所以在测试场景中需要准备Person对象给工作内存，点击“GIVEN”按钮弹出新建数据录入窗口，选择Person类，输入框中输入事实名称（名称任意），如下图</p>
<p><img src="/blog/images/202103/42.png" alt="42"></p>
<p>第四步：录入事实名称后点击后面的添加按钮，可以看到Person对象已经添加成功</p>
<p><img src="/blog/images/202103/43.png" alt="43"></p>
<p>第五步：我们给工作内存提供的Person对象还需要设置age属性的值，点击“添加字段”按钮弹出窗口，选择age属性</p>
<p><img src="/blog/images/202103/44.png" alt="44"></p>
<p>点击确定按钮后可以看到字段已经添加成功：</p>
<p><img src="/blog/images/202103/45.png" alt="45"></p>
<p>第六步：点击age属性后面的编辑按钮，弹出字段值窗口</p>
<p><img src="/blog/images/202103/image-20200113154817582.png" alt="image-20200113154817582"></p>
<p>第七步：在弹出的窗口中点击字面值按钮，重新回到测试场景页面，可以看到age后面出现输入框，可以为age属性设置值</p>
<p><img src="/blog/images/202103/image-20200113155136957.png" alt="image-20200113155136957"></p>
<p>设置好age属性的值后点击保存按钮保存测试场景</p>
<p>第八步：点击右上角“运行测试场景”按钮进行测试</p>
<p><img src="/blog/images/202103/image-20200113155332666.png" alt="image-20200113155332666"></p>
<p>测试成功后可以查看WorkBench部署的Tomcat控制台：</p>
<p><img src="/blog/images/202103/image-20200113155819517.png" alt="image-20200113155819517"></p>
<h4 id="8-3-5-设置-KieBase和KieSession"><a href="#8-3-5-设置-KieBase和KieSession" class="headerlink" title="8.3.5 设置 KieBase和KieSession"></a>8.3.5 设置 KieBase和KieSession</h4><p>第一步：在pro1项目页面点击右上角Settings按钮进入设置页面</p>
<p><img src="/blog/images/202103/image-20200113162923877.png" alt="image-20200113162923877"></p>
<p>第二步：在设置页面选择“知识库和会话”选项</p>
<p><img src="/blog/images/202103/image-20200113163005061.png" alt="image-20200113163005061"></p>
<p>第三步：在弹出的知识库和会话页面点击“添加”按钮进行设置</p>
<p><img src="/blog/images/202103/image-20200113163313305.png" alt="image-20200113163313305"></p>
<p><img src="/blog/images/202103/image-20200113163344174.png" alt="image-20200113163344174"></p>
<p>第四步：设置完成后点击右上角保存按钮完成设置操作，可以通过左侧浏览视图点击kmodule.xml，查看文件内容</p>
<p><img src="/blog/images/202103/image-20200113163539676.png" alt="image-20200113163539676"></p>
<h4 id="8-3-6-编译、构建、部署"><a href="#8-3-6-编译、构建、部署" class="headerlink" title="8.3.6 编译、构建、部署"></a>8.3.6 编译、构建、部署</h4><p>前面我们已经在WorkBench中创建了一个空间itheima，并且在此空间中创建了一个项目pro1，在此项目中创建了数据文件、规则文件和测试场景，如下图：</p>
<p><img src="/blog/images/202103/image-20200113160102668.png" alt="image-20200113160102668"></p>
<p>点击右上角“Compile”按钮可以对项目进行编译，点击“Bulid&amp;Deploy”按钮进行构建和部署。</p>
<p>部署成功后可以在本地maven仓库中看到当前项目已经被打成jar包：</p>
<p><img src="/blog/images/202103/image-20200113160728259.png" alt="image-20200113160728259"></p>
<p>将上面的jar包进行解压，可以看到我们创建的数据对象Person和规则文件person以及kmodule.xml都已经打到jar包中了。</p>
<h4 id="8-3-7-在项目中使用部署的规则"><a href="#8-3-7-在项目中使用部署的规则" class="headerlink" title="8.3.7 在项目中使用部署的规则"></a>8.3.7 在项目中使用部署的规则</h4><p>前面我们已经在WorkBench中创建了pro1项目，并且在pro1项目中创建了数据文件、规则文件等。最后我们将此项目打成jar包部署到了maven仓库中。本小节就需要在外部项目中使用我们定义的规则。</p>
<p>第一步：在IDEA中创建一个maven项目并在pom.xml文件中导入相关坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：在项目中创建一个数据对象Person，需要和WorkBench中创建的Person包名、类名完全相同，属性也需要对应</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.itheima.pro1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> implements java.io.Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="keyword">final</span> <span class="type">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> java.lang.<span class="type">String</span> id;</span><br><span class="line">    <span class="keyword">private</span> java.lang.<span class="type">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function"><span class="type">String</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setId</span><span class="params">(java.lang.<span class="type">String</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> java.lang.<span class="function"><span class="type">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setName</span><span class="params">(java.lang.<span class="type">String</span> name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setAge</span><span class="params">(<span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(java.lang.<span class="type">String</span> id, java.lang.<span class="type">String</span> name, <span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：编写单元测试，远程加载maven仓库中的jar包最终完成规则调用</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1<span class="literal">()</span> throws Exception&#123;</span><br><span class="line">    <span class="comment">//通过此URL可以访问到maven仓库中的jar包</span></span><br><span class="line">    <span class="comment">//URL地址构成：http://ip地址:Tomcat端口号/WorkBench工程名/maven2/坐标/版本号/xxx.jar</span></span><br><span class="line">    String url = </span><br><span class="line">    <span class="string">&quot;http://localhost:8080/kie-drools-wb/maven2/com/itheima/pro1/1.0.0/pro1-1.0.0.jar&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    KieServices kieServices = <span class="module-access"><span class="module"><span class="identifier">KieServices</span>.</span><span class="module"><span class="identifier">Factory</span>.</span></span>get<span class="literal">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过Resource资源对象加载jar包</span></span><br><span class="line">    UrlResource resource = (UrlResource) kieServices.get<span class="constructor">Resources()</span>.<span class="keyword">new</span><span class="constructor">UrlResource(<span class="params">url</span>)</span>;</span><br><span class="line">    <span class="comment">//通过Workbench提供的服务来访问maven仓库中的jar包资源，需要先进行Workbench的认证</span></span><br><span class="line">    resource.set<span class="constructor">Username(<span class="string">&quot;kie&quot;</span>)</span>;</span><br><span class="line">    resource.set<span class="constructor">Password(<span class="string">&quot;kie&quot;</span>)</span>;</span><br><span class="line">    resource.set<span class="constructor">BasicAuthentication(<span class="string">&quot;enabled&quot;</span>)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将资源转换为输入流，通过此输入流可以读取jar包数据</span></span><br><span class="line">    InputStream inputStream = resource.get<span class="constructor">InputStream()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建仓库对象，仓库对象中保存Drools的规则信息</span></span><br><span class="line">    KieRepository repository = kieServices.get<span class="constructor">Repository()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过输入流读取maven仓库中的jar包数据，包装成KieModule模块添加到仓库中</span></span><br><span class="line">    KieModule kieModule = </span><br><span class="line">    repository.</span><br><span class="line">        add<span class="constructor">KieModule(<span class="params">kieServices</span>.<span class="params">getResources</span>()</span>.<span class="keyword">new</span><span class="constructor">InputStreamResource(<span class="params">inputStream</span>)</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//基于KieModule模块创建容器对象，从容器中可以获取session会话</span></span><br><span class="line">    KieContainer kieContainer = kieServices.<span class="keyword">new</span><span class="constructor">KieContainer(<span class="params">kieModule</span>.<span class="params">getReleaseId</span>()</span>);</span><br><span class="line">    KieSession session = kieContainer.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line"></span><br><span class="line">    Person person = <span class="keyword">new</span> <span class="constructor">Person()</span>;</span><br><span class="line">    person.set<span class="constructor">Age(10)</span>;</span><br><span class="line">    session.insert(person);</span><br><span class="line"></span><br><span class="line">    session.fire<span class="constructor">AllRules()</span>;</span><br><span class="line">    session.dispose<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行单元测试可以发现控制台已经输出了相关内容。通过WorkBench修改规则输出内容并发布，再次执行单元测试可以发现控制台输出的内容也发生了变化。</p>
<p>通过上面的案例可以发现，我们在IEDA中开发的项目中并没有编写规则文件，规则文件是我们通过WorkBench开发并安装部署到maven仓库中，我们自己开发的项目只需要远程加载maven仓库中的jar包就可以完成规则的调用。这种开发方式的好处是我们的应用可以和业务规则完全分离，同时通过WorkBench修改规则后我们的应用不需要任何修改就可以加载到最新的规则从而实现规则的动态变更。</p>
<h2 id="9-Drools实战"><a href="#9-Drools实战" class="headerlink" title="9. Drools实战"></a>9. Drools实战</h2><h3 id="9-1-个人所得税计算器"><a href="#9-1-个人所得税计算器" class="headerlink" title="9.1 个人所得税计算器"></a>9.1 个人所得税计算器</h3><p>本小节我们需要通过Drools规则引擎来根据规则计算个人所得税，最终页面效果如下：</p>
<p><img src="/blog/images/202103/image-20200214132448956.png" alt="image-20200214132448956"></p>
<h4 id="9-1-1-名词解释"><a href="#9-1-1-名词解释" class="headerlink" title="9.1.1 名词解释"></a>9.1.1 名词解释</h4><p>税前月收入：即税前工资，指交纳个人所得税之前的总工资</p>
<p>应纳税所得额：指按照税法规定确定纳税人在一定期间所获得的所有应税收入减除在该纳税期间依法允许减除的各种支出后的余额</p>
<p>税率：是对征税对象的征收比例或征收额度</p>
<p>速算扣除数：指为解决超额累进税率分级计算税额的复杂技术问题，而预先计算出的一个数据，可以简化计算过程</p>
<p>扣税额：是指实际缴纳的税额</p>
<p>税后工资：是指扣完税后实际到手的工资收入</p>
<h4 id="9-1-2-计算规则"><a href="#9-1-2-计算规则" class="headerlink" title="9.1.2 计算规则"></a>9.1.2 计算规则</h4><p>要实现个人所得税计算器，需要了解如下计算规则：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">计算应纳税所得额</td>
<td align="left">应纳税所得额为税前工资减去3500</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">设置税率，应纳税所得额&lt;&#x3D;1500</td>
<td align="left">税率为0.03，速算扣除数为0</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">设置税率，应纳税所得额在1500至4500之间</td>
<td align="left">税率为0.1，速算扣除数为105</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">设置税率，应纳税所得额在4500志9000之间</td>
<td align="left">税率为0.2，速算扣除数为555</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">设置税率，应纳税所得额在9000志35000之间</td>
<td align="left">税率为0.25，速算扣除数为1005</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">设置税率，应纳税所得额在35000至55000之间</td>
<td align="left">税率为0.3，速算扣除数为2755</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">设置税率，应纳税所得额在55000至80000之间</td>
<td align="left">税率为0.35，速算扣除数为5505</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">设置税率，应纳税所得额在80000以上</td>
<td align="left">税率为0.45，速算扣除数为13505</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">计算税后工资</td>
<td align="left">扣税额&#x3D;应纳税所得额*税率-速算扣除数 税后工资&#x3D;税前工资-扣税额</td>
</tr>
</tbody></table>
<h4 id="9-1-3-实现步骤"><a href="#9-1-3-实现步骤" class="headerlink" title="9.1.3 实现步骤"></a>9.1.3 实现步骤</h4><p>本实战案例我们基于Spring Boot整合Drools的方式来实现。</p>
<p>第一步：创建maven工程calculation并配置pom.xml文件</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starters<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>calculation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--drools规则引擎--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-templates<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$</span><span class="template-variable">&#123;project.artifactId&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：创建&#x2F;resources&#x2F;application.yml文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">calculation</span></span><br></pre></td></tr></table></figure>

<p>第三步：编写配置类DroolsConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.config;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieServices;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieBuilder;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieFileSystem;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieRepository;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieContainer;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.kie.internal.io.ResourceFactory;</span><br><span class="line"><span class="keyword">import</span> org.kie.spring.KModuleBeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 规则引擎配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsConfig</span> &#123;</span><br><span class="line">    <span class="comment">//指定规则文件存放的目录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RULES_PATH</span> <span class="operator">=</span> <span class="string">&quot;rules/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">KieServices</span> <span class="variable">kieServices</span> <span class="operator">=</span> KieServices.Factory.get();</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieFileSystem <span class="title function_">kieFileSystem</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;drools.dateformat&quot;</span>,<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">KieFileSystem</span> <span class="variable">kieFileSystem</span> <span class="operator">=</span> kieServices.newKieFileSystem();</span><br><span class="line">        <span class="type">ResourcePatternResolver</span> <span class="variable">resourcePatternResolver</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">        Resource[] files = </span><br><span class="line">            resourcePatternResolver.getResources(<span class="string">&quot;classpath*:&quot;</span> + RULES_PATH + <span class="string">&quot;*.*&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Resource file : files) &#123;</span><br><span class="line">            path = RULES_PATH + file.getFilename();</span><br><span class="line">            kieFileSystem.write(ResourceFactory.newClassPathResource(path, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> kieFileSystem;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieContainer <span class="title function_">kieContainer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">KieRepository</span> <span class="variable">kieRepository</span> <span class="operator">=</span> kieServices.getRepository();</span><br><span class="line">        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);</span><br><span class="line">        <span class="type">KieBuilder</span> <span class="variable">kieBuilder</span> <span class="operator">=</span> kieServices.newKieBuilder(kieFileSystem());</span><br><span class="line">        kieBuilder.buildAll();</span><br><span class="line">        <span class="keyword">return</span> kieServices.newKieContainer(kieRepository.getDefaultReleaseId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieBase <span class="title function_">kieBase</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> kieContainer().getKieBase();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KModuleBeanFactoryPostProcessor <span class="title function_">kiePostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KModuleBeanFactoryPostProcessor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：编写实体类Calculation</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>.<span class="property">entity</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculation</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> double wage;<span class="comment">//税前工资</span></span><br><span class="line">    <span class="keyword">private</span> double wagemore;<span class="comment">//应纳税所得额</span></span><br><span class="line">    <span class="keyword">private</span> double cess;<span class="comment">//税率</span></span><br><span class="line">    <span class="keyword">private</span> double preminus;<span class="comment">//速算扣除数</span></span><br><span class="line">    <span class="keyword">private</span> double wageminus;<span class="comment">//扣税额</span></span><br><span class="line">    <span class="keyword">private</span> double actualwage;<span class="comment">//税后工资</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getWage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> wage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWage</span>(<span class="params">double wage</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wage</span> = wage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getActualwage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> actualwage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setActualwage</span>(<span class="params">double actualwage</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">actualwage</span> = actualwage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getWagemore</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> wagemore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWagemore</span>(<span class="params">double wagemore</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wagemore</span> = wagemore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getCess</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> cess;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCess</span>(<span class="params">double cess</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cess</span> = cess;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getPreminus</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> preminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setPreminus</span>(<span class="params">double preminus</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">preminus</span> = preminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getWageminus</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> wageminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWageminus</span>(<span class="params">double wageminus</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wageminus</span> = wageminus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Calculation&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;wage=&quot;</span> + wage +</span><br><span class="line">                <span class="string">&quot;, actualwage=&quot;</span> + actualwage +</span><br><span class="line">                <span class="string">&quot;, wagemore=&quot;</span> + wagemore +</span><br><span class="line">                <span class="string">&quot;, cess=&quot;</span> + cess +</span><br><span class="line">                <span class="string">&quot;, preminus=&quot;</span> + preminus +</span><br><span class="line">                <span class="string">&quot;, wageminus=&quot;</span> + wageminus +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五步：在resources&#x2F;rules下创建规则文件calculation.drl文件</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package calculation</span><br><span class="line">import com.itheima.drools.entity.Calculation</span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：计算应纳税所得额&quot;</span></span><br><span class="line">    enabled <span class="literal">true</span></span><br><span class="line">    salience <span class="number">3</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    date-effective <span class="string">&quot;2011-09-01&quot;</span> <span class="comment">//生效日期</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wage</span>&gt;0)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Wagemore($<span class="params">cal</span>.<span class="params">getWage</span>()</span>-<span class="number">3500</span>);</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额&lt;=1500&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &lt;= 1500)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.03)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(0)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在1500至4500之间&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &gt; 1500 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &lt;= 4500)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.1)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(105)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在4500志9000之间&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &gt; 4500 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &lt;= 9000)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.2)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(555)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在9000志35000之间&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &gt; 9000 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &lt;= 35000)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.25)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(1005)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在35000至55000之间&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &gt; 35000 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &lt;= 55000)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.3)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(2755)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在55000至80000之间&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &gt; 55000 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &lt;= 80000)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.35)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(5505)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：设置税率--&gt;&gt;应纳税所得额在80000以上&quot;</span></span><br><span class="line">    salience <span class="number">2</span></span><br><span class="line">    no-loop <span class="literal">true</span></span><br><span class="line">    activation-group <span class="string">&quot;SETCess_Group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wagemore</span> &gt; 80000)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Cess(0.45)</span>;</span><br><span class="line">        $cal.set<span class="constructor">Preminus(13505)</span>;</span><br><span class="line">        update($cal);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;个人所得税：计算税后工资&quot;</span></span><br><span class="line">    salience <span class="number">1</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $cal : <span class="constructor">Calculation(<span class="params">wage</span> &gt; 0 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &gt; 0 <span class="operator">&amp;&amp;</span> <span class="params">wagemore</span> &gt; 0 <span class="operator">&amp;&amp;</span> <span class="params">cess</span> &gt; 0)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        $cal.set<span class="constructor">Wageminus($<span class="params">cal</span>.<span class="params">getWagemore</span>()</span>*$cal.get<span class="constructor">Cess()</span>-$cal.get<span class="constructor">Preminus()</span>);</span><br><span class="line">        $cal.set<span class="constructor">Actualwage($<span class="params">cal</span>.<span class="params">getWage</span>()</span>-$cal.get<span class="constructor">Wageminus()</span>);</span><br><span class="line"></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;-----税前工资：&quot;</span>+$cal.get<span class="constructor">Wage()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;-----应纳税所得额：&quot;</span>+$cal.get<span class="constructor">Wagemore()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;-----税率：&quot;</span> + $cal.get<span class="constructor">Cess()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;-----速算扣除数：&quot;</span> + $cal.get<span class="constructor">Preminus()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;-----扣税额：&quot;</span> + $cal.get<span class="constructor">Wageminus()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;-----税后工资：&quot;</span> + $cal.get<span class="constructor">Actualwage()</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第六步：创建RuleService</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.Calculation;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 调用规则引擎，执行规则</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Service</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuleService</span> </span>&#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    <span class="keyword">private</span> KieBase kieBase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//个人所得税计算</span></span><br><span class="line">    <span class="keyword">public</span> Calculation calculate(Calculation calculation)&#123;</span><br><span class="line">        KieSession kieSession = kieBase.<span class="keyword">new</span><span class="type">KieSession</span>();</span><br><span class="line">        kieSession.insert(calculation);</span><br><span class="line">        kieSession.fireAllRules();</span><br><span class="line">        kieSession.dispose();</span><br><span class="line">        <span class="keyword">return</span> calculation;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建RuleController</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.Calculation;</span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.service.RuleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/rule&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleService ruleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(<span class="string">&quot;/calculate&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Calculation calculate(double wage)&#123;</span><br><span class="line">        Calculation calculation = new Calculation();</span><br><span class="line">        calculation.setWage(wage);</span><br><span class="line">        calculation = ruleService.calculate(calculation);</span><br><span class="line">        System.<span class="keyword">out</span>.println(calculation);</span><br><span class="line">        <span class="keyword">return</span> calculation;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：创建启动类DroolsApplication</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">SpringApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">autoconfigure</span>.<span class="property">SpringBootApplication</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">SpringApplication</span>.<span class="title function_">run</span>(<span class="title class_">DroolsApplication</span>.<span class="property">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第九步：导入静态资源文件到resources&#x2F;static目录下</p>
<h3 id="9-2-信用卡申请"><a href="#9-2-信用卡申请" class="headerlink" title="9.2 信用卡申请"></a>9.2 信用卡申请</h3><p>本小节我们需要通过Drools规则引擎来根据规则进行申请人的合法性检查，检查通过后再根据规则确定信用卡额度，最终页面效果如下：</p>
<p><img src="/blog/images/202103/image-20200214202525859.png" alt="image-20200214202525859"></p>
<h4 id="9-2-1-计算规则"><a href="#9-2-1-计算规则" class="headerlink" title="9.2.1 计算规则"></a>9.2.1 计算规则</h4><p>合法性检查规则如下：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">检查学历与薪水1</td>
<td align="left">如果申请人既没房也没车，同时学历为大专以下，并且月薪少于5000，那么不通过</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">检查学历与薪水2</td>
<td align="left">如果申请人既没房也没车，同时学历为大专或本科，并且月薪少于3000，那么不通过</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">检查学历与薪水3</td>
<td align="left">如果申请人既没房也没车，同时学历为本科以上，并且月薪少于2000，同时之前没有信用卡的，那么不通过</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">检查申请人已有的信用卡数量</td>
<td align="left">如果申请人现有的信用卡数量大于10，那么不通过</td>
</tr>
</tbody></table>
<p>信用卡额度确定规则：</p>
<table>
<thead>
<tr>
<th align="left">规则编号</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">规则1</td>
<td align="left">如果申请人有房有车，或者月收入在20000以上，那么发放的信用卡额度为15000</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">规则2</td>
<td align="left">如果申请人没房没车，但月收入在10000~20000之间，那么发放的信用卡额度为6000</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">规则3</td>
<td align="left">如果申请人没房没车，月收入在10000以下，那么发放的信用卡额度为3000</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">规则4</td>
<td align="left">如果申请人有房没车或者没房但有车，月收入在10000以下，那么发放的信用卡额度为5000</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">规则5</td>
<td align="left">如果申请人有房没车或者是没房但有车，月收入在10000~20000之间，那么发放的信用卡额度为8000</td>
</tr>
</tbody></table>
<h4 id="9-2-2-实现步骤"><a href="#9-2-2-实现步骤" class="headerlink" title="9.2.2 实现步骤"></a>9.2.2 实现步骤</h4><p>第一步：创建maven工程creditCardApply并配置pom.xml文件</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starters<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>creditCardApply<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--drools规则引擎--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-templates<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$</span><span class="template-variable">&#123;project.artifactId&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：创建&#x2F;resources&#x2F;application.yml文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">creditCardApply</span></span><br></pre></td></tr></table></figure>

<p>第三步：编写配置类DroolsConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.config;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieServices;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieBuilder;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieFileSystem;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.KieRepository;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieContainer;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.kie.internal.io.ResourceFactory;</span><br><span class="line"><span class="keyword">import</span> org.kie.spring.KModuleBeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 规则引擎配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsConfig</span> &#123;</span><br><span class="line">    <span class="comment">//指定规则文件存放的目录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RULES_PATH</span> <span class="operator">=</span> <span class="string">&quot;rules/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">KieServices</span> <span class="variable">kieServices</span> <span class="operator">=</span> KieServices.Factory.get();</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieFileSystem <span class="title function_">kieFileSystem</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">KieFileSystem</span> <span class="variable">kieFileSystem</span> <span class="operator">=</span> kieServices.newKieFileSystem();</span><br><span class="line">        <span class="type">ResourcePatternResolver</span> <span class="variable">resourcePatternResolver</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">        Resource[] files =</span><br><span class="line">                resourcePatternResolver.getResources(<span class="string">&quot;classpath*:&quot;</span> + RULES_PATH + <span class="string">&quot;*.*&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Resource file : files) &#123;</span><br><span class="line">            path = RULES_PATH + file.getFilename();</span><br><span class="line">            kieFileSystem.write(ResourceFactory.newClassPathResource(path, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> kieFileSystem;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieContainer <span class="title function_">kieContainer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">KieRepository</span> <span class="variable">kieRepository</span> <span class="operator">=</span> kieServices.getRepository();</span><br><span class="line">        kieRepository.addKieModule(kieRepository::getDefaultReleaseId);</span><br><span class="line">        <span class="type">KieBuilder</span> <span class="variable">kieBuilder</span> <span class="operator">=</span> kieServices.newKieBuilder(kieFileSystem());</span><br><span class="line">        kieBuilder.buildAll();</span><br><span class="line">        <span class="keyword">return</span> kieServices.newKieContainer(kieRepository.getDefaultReleaseId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KieBase <span class="title function_">kieBase</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> kieContainer().getKieBase();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> KModuleBeanFactoryPostProcessor <span class="title function_">kiePostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KModuleBeanFactoryPostProcessor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：编写实体类CreditCardApplyInfo</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>.<span class="property">entity</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 信用卡申请信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreditCardApplyInfo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">EDUCATION_1</span> = <span class="string">&quot;专科以下&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">EDUCATION_2</span> = <span class="string">&quot;专科&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">EDUCATION_3</span> = <span class="string">&quot;本科&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">EDUCATION_4</span> = <span class="string">&quot;本科以上&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> sex;</span><br><span class="line">    <span class="keyword">private</span> int age;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> education;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> telephone;</span><br><span class="line">    <span class="keyword">private</span> double monthlyIncome = <span class="number">0</span>;<span class="comment">//月收入</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> hasHouse = <span class="literal">false</span>;<span class="comment">//是否有房</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> hasCar = <span class="literal">false</span>;<span class="comment">//是否有车</span></span><br><span class="line">    <span class="keyword">private</span> int hasCreditCardCount = <span class="number">0</span>;<span class="comment">//现持有信用卡数量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> checkResult = <span class="literal">true</span>;<span class="comment">//审核是否通过</span></span><br><span class="line">    <span class="keyword">private</span> double quota = <span class="number">0</span>;<span class="comment">//额度</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setName</span>(<span class="params"><span class="built_in">String</span> name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getSex</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSex</span>(<span class="params"><span class="built_in">String</span> sex</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sex</span> = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getAge</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setAge</span>(<span class="params">int age</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getEducation</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> education;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setEducation</span>(<span class="params"><span class="built_in">String</span> education</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">education</span> = education;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getTelephone</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setTelephone</span>(<span class="params"><span class="built_in">String</span> telephone</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">telephone</span> = telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getMonthlyIncome</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> monthlyIncome;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMonthlyIncome</span>(<span class="params">double monthlyIncome</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">monthlyIncome</span> = monthlyIncome;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getAddress</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setAddress</span>(<span class="params"><span class="built_in">String</span> address</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">address</span> = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">isHasHouse</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hasHouse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setHasHouse</span>(<span class="params"><span class="built_in">boolean</span> hasHouse</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hasHouse</span> = hasHouse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">isHasCar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hasCar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setHasCar</span>(<span class="params"><span class="built_in">boolean</span> hasCar</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hasCar</span> = hasCar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getHasCreditCardCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hasCreditCardCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setHasCreditCardCount</span>(<span class="params">int hasCreditCardCount</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hasCreditCardCount</span> = hasCreditCardCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">isCheckResult</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> checkResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCheckResult</span>(<span class="params"><span class="built_in">boolean</span> checkResult</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">checkResult</span> = checkResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> double <span class="title function_">getQuota</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> quota;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setQuota</span>(<span class="params">double quota</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">quota</span> = quota;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(checkResult)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;审核通过，信用卡额度为：&quot;</span> + quota;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;审核不通过&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第五步：在resources&#x2F;rules下创建规则文件creditCardApply.drl文件</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">package com.itheima.creditCardApply</span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.CreditCardApplyInfo</span><br><span class="line"></span><br><span class="line">//合法性检查</span><br><span class="line">rule <span class="string">&quot;如果申请人既没房也没车，同时学历为大专以下，并且月薪少于5000，那么不通过&quot;</span></span><br><span class="line">    salience <span class="number">10</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(hasCar ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                hasHouse ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                education == CreditCardApplyInfo.EDUCATION_1 &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; <span class="number">5000</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setCheckResult<span class="built_in">(false</span>);</span><br><span class="line">        drools.halt();</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人既没房也没车，同时学历为大专或本科，并且月薪少于3000，那么不通过&quot;</span></span><br><span class="line">    salience <span class="number">10</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(hasCar ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                hasHouse ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                (education == CreditCardApplyInfo.EDUCATION_2  ||</span><br><span class="line">                                education == CreditCardApplyInfo.EDUCATION_3) &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; <span class="number">3000</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setCheckResult<span class="built_in">(false</span>);</span><br><span class="line">        drools.halt();</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人既没房也没车，同时学历为本科以上，并且月薪少于2000，同时之前没有信用卡的，那么不通过&quot;</span></span><br><span class="line">    salience <span class="number">10</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(hasCar ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                hasHouse ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                education == CreditCardApplyInfo.EDUCATION_4 &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; <span class="number">2000</span> &amp;&amp;</span><br><span class="line">                                hasCreditCardCount == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setCheckResult<span class="built_in">(false</span>);</span><br><span class="line">        drools.halt();</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人现有的信用卡数量大于10，那么不通过&quot;</span></span><br><span class="line">    salience <span class="number">10</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(hasCreditCardCount &gt; <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setCheckResult<span class="built_in">(false</span>);</span><br><span class="line">        drools.halt();</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">//确定额度</span><br><span class="line">rule <span class="string">&quot;如果申请人有房有车，或者月收入在20000以上，那么发放的信用卡额度为15000&quot;</span></span><br><span class="line">    salience <span class="number">1</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    activation-group <span class="string">&quot;quota_group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(checkResult ==<span class="built_in"> true</span> &amp;&amp;</span><br><span class="line">                                ((hasHouse ==<span class="built_in"> true</span> &amp;&amp; hasCar ==<span class="built_in"> true</span>) ||</span><br><span class="line">                                (monthlyIncome &gt; <span class="number">20000</span>)))</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setQuota(<span class="number">15000</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人没房没车，但月收入在10000~20000之间，那么发放的信用卡额度为6000&quot;</span></span><br><span class="line">    salience <span class="number">1</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    activation-group <span class="string">&quot;quota_group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(checkResult ==<span class="built_in"> true</span> &amp;&amp;</span><br><span class="line">                                hasHouse ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                hasCar ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                monthlyIncome &gt;= <span class="number">10000</span> &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt;= <span class="number">20000</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setQuota(<span class="number">6000</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人没房没车，月收入在10000以下，那么发放的信用卡额度为3000&quot;</span></span><br><span class="line">    salience <span class="number">1</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    activation-group <span class="string">&quot;quota_group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(checkResult ==<span class="built_in"> true</span> &amp;&amp;</span><br><span class="line">                                        hasHouse ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                        hasCar ==<span class="built_in"> false</span> &amp;&amp;</span><br><span class="line">                                        monthlyIncome &lt; <span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setQuota(<span class="number">3000</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人有房没车或者没房但有车，月收入在10000以下，那么发放的信用卡额度为5000&quot;</span></span><br><span class="line">    salience <span class="number">1</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    activation-group <span class="string">&quot;quota_group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(checkResult ==<span class="built_in"> true</span> &amp;&amp;</span><br><span class="line">                                ((hasHouse ==<span class="built_in"> true</span> &amp;&amp; hasCar ==<span class="built_in"> false</span>) ||</span><br><span class="line">                                (hasHouse ==<span class="built_in"> false</span> &amp;&amp; hasCar ==<span class="built_in"> true</span>)) &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt; <span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setQuota(<span class="number">5000</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">rule <span class="string">&quot;如果申请人有房没车或者是没房但有车，月收入在10000~20000之间，那么发放的信用卡额度为8000&quot;</span></span><br><span class="line">    salience <span class="number">1</span></span><br><span class="line">    no-loop<span class="built_in"> true</span></span><br><span class="line">    activation-group <span class="string">&quot;quota_group&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        <span class="variable">$c:CreditCardApplyInfo</span>(checkResult ==<span class="built_in"> true</span> &amp;&amp;</span><br><span class="line">                                ((hasHouse ==<span class="built_in"> true</span> &amp;&amp; hasCar ==<span class="built_in"> false</span>) ||</span><br><span class="line">                                (hasHouse ==<span class="built_in"> false</span> &amp;&amp; hasCar ==<span class="built_in"> true</span>)) &amp;&amp;</span><br><span class="line">                                monthlyIncome &gt;= <span class="number">10000</span> &amp;&amp;</span><br><span class="line">                                monthlyIncome &lt;= <span class="number">20000</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="variable">$c</span>.setQuota(<span class="number">8000</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>第六步：创建RuleService</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.CreditCardApplyInfo;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.KieBase;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KieBase kieBase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用Drools规则引擎实现信用卡申请</span></span><br><span class="line">    <span class="keyword">public</span> CreditCardApplyInfo <span class="title function_">creditCardApply</span><span class="params">(CreditCardApplyInfo creditCardApplyInfo)</span>&#123;</span><br><span class="line">        <span class="type">KieSession</span> <span class="variable">session</span> <span class="operator">=</span> kieBase.newKieSession();</span><br><span class="line">        session.insert(creditCardApplyInfo);</span><br><span class="line">        session.fireAllRules();</span><br><span class="line">        session.dispose();</span><br><span class="line">        <span class="keyword">return</span> creditCardApplyInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建RuleController</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.CreditCardApplyInfo;</span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.service.RuleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.<span class="keyword">annotation</span>.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/rule&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleService ruleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(<span class="string">&quot;/creditCardApply&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> CreditCardApplyInfo creditCardApply(<span class="meta">@RequestBody</span> </span><br><span class="line">        CreditCardApplyInfo creditCardApplyInfo)&#123;</span><br><span class="line">        creditCardApplyInfo = ruleService.creditCardApply(creditCardApplyInfo);</span><br><span class="line">        <span class="keyword">return</span> creditCardApplyInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：创建启动类DroolsApplication</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">SpringApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">autoconfigure</span>.<span class="property">SpringBootApplication</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">SpringApplication</span>.<span class="title function_">run</span>(<span class="title class_">DroolsApplication</span>.<span class="property">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第九步：导入静态资源文件到resources&#x2F;static目录下</p>
<h3 id="9-3-保险产品准入规则"><a href="#9-3-保险产品准入规则" class="headerlink" title="9.3 保险产品准入规则"></a>9.3 保险产品准入规则</h3><h4 id="9-3-1-决策表"><a href="#9-3-1-决策表" class="headerlink" title="9.3.1 决策表"></a>9.3.1 决策表</h4><p>前面的课程中我们编写的规则文件都是drl形式的文件，Drools除了支持drl形式的文件外还支持xls格式的文件（即Excel文件）。这种xls格式的文件通常称为决策表（decision table）。</p>
<p>决策表（decision table）是一个“精确而紧凑的”表示条件逻辑的方式，非常适合商业级别的规则。决策表与现有的drl文件可以无缝替换。Drools提供了相应的API可以将xls文件编译为drl格式的字符串。</p>
<p>一个决策表的例子如下：</p>
<p><img src="/blog/images/202103/image-20200217160930138.png" alt="image-20200217160930138"></p>
<p>决策表语法：</p>
<table>
<thead>
<tr>
<th align="left">关键字</th>
<th align="left">说明</th>
<th align="left">是否必须</th>
</tr>
</thead>
<tbody><tr>
<td align="left">RuleSet</td>
<td align="left">相当于drl文件中的package</td>
<td align="left">必须，只能有一个。如果没有设置RuleSet对应的值则使用默认值rule_table</td>
</tr>
<tr>
<td align="left">Sequential</td>
<td align="left">取值为Boolean类型。true表示规则按照表格自上到下的顺序执行，false表示乱序</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">Import</td>
<td align="left">相当于drl文件中的import，如果引入多个类则类之间用逗号分隔</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">Variables</td>
<td align="left">相当于drl文件中的global，用于定义全局变量，如果有多个全局变量则中间用逗号分隔</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">RuleTable</td>
<td align="left">它指示了后面将会有一批rule，RuleTable的名称将会作为以后生成rule的前缀</td>
<td align="left">必须</td>
</tr>
<tr>
<td align="left">CONDITION</td>
<td align="left">规则条件关键字，相当于drl文件中的when。下面两行则表示 LHS 部分，第三行则为注释行，不计为规则部分，从第四行开始，每一行表示一条规则</td>
<td align="left">每个规则表至少有一个</td>
</tr>
<tr>
<td align="left">ACTION</td>
<td align="left">规则结果关键字，相当于drl文件中的then</td>
<td align="left">每个规则表至少有一个</td>
</tr>
<tr>
<td align="left">NO-LOOP</td>
<td align="left">相当于drl文件中的no-loop</td>
<td align="left">可选</td>
</tr>
<tr>
<td align="left">AGENDA-GROUP</td>
<td align="left">相当于drl文件中的agenda-group</td>
<td align="left">可选</td>
</tr>
</tbody></table>
<p>在决策表中还经常使用到占位符，语法为$后面加数字，用于替换每条规则中设置的具体值。</p>
<p>上面的决策表例子转换为drl格式的规则文件内容如下：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">package rules;</span><br><span class="line"></span><br><span class="line">import com.itheima.drools.entity.PersonInfoEntity;</span><br><span class="line">import java.util.List;</span><br><span class="line">global java.util.List listRules;</span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;personCheck_10&quot;</span></span><br><span class="line">    salience <span class="number">65535</span></span><br><span class="line">    agenda-group <span class="string">&quot;sign&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $person : <span class="constructor">PersonInfoEntity(<span class="params">sex</span> != <span class="string">&quot;男&quot;</span>)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        listRules.add(<span class="string">&quot;性别不对&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;personCheck_11&quot;</span></span><br><span class="line">    salience <span class="number">65534</span></span><br><span class="line">    agenda-group <span class="string">&quot;sign&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $person : <span class="constructor">PersonInfoEntity(<span class="params">age</span> &lt; 22 <span class="operator">||</span> <span class="params">age</span> &gt; 25)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        listRules.add(<span class="string">&quot;年龄不合适&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">rule <span class="string">&quot;personCheck_12&quot;</span></span><br><span class="line">    salience <span class="number">65533</span></span><br><span class="line">    agenda-group <span class="string">&quot;sign&quot;</span></span><br><span class="line">    <span class="keyword">when</span></span><br><span class="line">        $person : <span class="constructor">PersonInfoEntity(<span class="params">salary</span> &lt; 10000)</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        listRules.add(<span class="string">&quot;工资太低了&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>要进行决策表相关操作，需要导入如下maven坐标：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-decisiontables<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过下图可以发现，由于maven的依赖传递特性在导入drools-decisiontables坐标后，drools-core和drools-compiler等坐标也被传递了过来</p>
<p><img src="/blog/images/202103/image-20200218105819932.png" alt="image-20200218105819932"></p>
<p>Drools提供的将xls文件编译为drl格式字符串的API如下：</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line"><span class="built_in">String</span> realPath = <span class="string">&quot;C:\\testRule.xls&quot;</span>;//指定决策表xls文件的磁盘路径</span><br><span class="line"><span class="keyword">File</span> <span class="keyword">file</span> = <span class="keyword">new</span> <span class="keyword">File</span>(realPath);</span><br><span class="line">InputStream <span class="keyword">is</span> = <span class="keyword">new</span> FileInputStream(<span class="keyword">file</span>);</span><br><span class="line">SpreadsheetCompiler compiler = <span class="keyword">new</span> SpreadsheetCompiler();</span><br><span class="line"><span class="built_in">String</span> drl = compiler.compile(<span class="keyword">is</span>, InputType.XLS);</span><br></pre></td></tr></table></figure>

<p>Drools还提供了基于drl格式字符串创建KieSession的API：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">KieHelper kieHelper = <span class="keyword">new</span> <span class="constructor">KieHelper()</span>;</span><br><span class="line">kieHelper.add<span class="constructor">Content(<span class="params">drl</span>, ResourceType.DRL)</span>;</span><br><span class="line">KieSession session = kieHelper.build<span class="literal">()</span>.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br></pre></td></tr></table></figure>

<p>基于决策表的入门案例：</p>
<p>第一步：创建maven工程drools_decisiontable_demo并配置pom.xml文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-decisiontables<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：创建实体类PersonInfoEntity</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonInfoEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">String</span> <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setSex</span><span class="params">(<span class="type">String</span> sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setAge</span><span class="params">(<span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">double</span> <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">setSalary</span><span class="params">(<span class="type">double</span> salary)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：创建xls规则文件（可以直接使用资料中提供的testRule.xls文件）</p>
<p>第四步：创建单元测试</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1<span class="literal">()</span> throws Exception&#123;</span><br><span class="line">    String realPath = <span class="string">&quot;d:\\testRule.xls&quot;</span>;<span class="comment">//指定决策表xls文件的磁盘路径</span></span><br><span class="line">    File file = <span class="keyword">new</span> <span class="constructor">File(<span class="params">realPath</span>)</span>;</span><br><span class="line">    InputStream is = <span class="keyword">new</span> <span class="constructor">FileInputStream(<span class="params">file</span>)</span>;</span><br><span class="line">    SpreadsheetCompiler compiler = <span class="keyword">new</span> <span class="constructor">SpreadsheetCompiler()</span>;</span><br><span class="line">    String drl = compiler.compile(is, InputType.XLS);</span><br><span class="line"></span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(drl);</span><br><span class="line">    KieHelper kieHelper = <span class="keyword">new</span> <span class="constructor">KieHelper()</span>;</span><br><span class="line">    kieHelper.add<span class="constructor">Content(<span class="params">drl</span>, ResourceType.DRL)</span>;</span><br><span class="line">    KieSession session = kieHelper.build<span class="literal">()</span>.<span class="keyword">new</span><span class="constructor">KieSession()</span>;</span><br><span class="line"></span><br><span class="line">    PersonInfoEntity personInfoEntity = <span class="keyword">new</span> <span class="constructor">PersonInfoEntity()</span>;</span><br><span class="line">    personInfoEntity.set<span class="constructor">Sex(<span class="string">&quot;男&quot;</span>)</span>;</span><br><span class="line">    personInfoEntity.set<span class="constructor">Age(35)</span>;</span><br><span class="line">    personInfoEntity.set<span class="constructor">Salary(1000)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;String&gt;<span class="literal">()</span>;</span><br><span class="line">    session.set<span class="constructor">Global(<span class="string">&quot;listRules&quot;</span>,<span class="params">list</span>)</span>;</span><br><span class="line"></span><br><span class="line">    session.insert(personInfoEntity);</span><br><span class="line">    </span><br><span class="line">    session.get<span class="constructor">Agenda()</span>.get<span class="constructor">AgendaGroup(<span class="string">&quot;sign&quot;</span>)</span>.set<span class="constructor">Focus()</span>;</span><br><span class="line">    </span><br><span class="line">    session.fire<span class="constructor">AllRules()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String s : <span class="built_in">list</span>) &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    session.dispose<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-3-2-规则介绍"><a href="#9-3-2-规则介绍" class="headerlink" title="9.3.2 规则介绍"></a>9.3.2 规则介绍</h4><p>各保险公司针对人身、财产推出了不同的保险产品，作为商业保险公司，筛选出符合公司利益最大化的客户是非常重要的，即各保险产品的准入人群是不同的，也就是说保险公司会针对不同的人群特征，制定不同的产品缴费和赔付规则。</p>
<p>我们来看一下某保险产品准入规则的简化版，当不满足以下规则时，系统模块需要返回准入失败标识和失败原因</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">规则<span class="number">1</span>：  保险公司是：PICC</span><br><span class="line">规则<span class="number">2</span>：  销售区域是：北京、天津</span><br><span class="line">规则<span class="number">3</span>：  投保人年龄：<span class="number">0</span> ~ <span class="number">17</span>岁</span><br><span class="line">规则<span class="number">4</span>：  保险期间是：<span class="number">20</span>年、<span class="number">25</span>年、<span class="number">30</span>年</span><br><span class="line">规则<span class="number">5</span>：  缴费方式是：趸交（一次性交清）或年交</span><br><span class="line">规则<span class="number">6</span>：  保险期与交费期规则一：保险期间为<span class="number">20</span>年期交费期间最长<span class="number">10</span>年交且不能选择<span class="selector-attr">[趸交]</span></span><br><span class="line">规则<span class="number">7</span>：  保险期与交费期规则二：保险期间为<span class="number">25</span>年期交费期间最长<span class="number">15</span>年交且不能选择<span class="selector-attr">[趸交]</span></span><br><span class="line">规则<span class="number">8</span>：  保险期与交费期规则三：保险期间为<span class="number">30</span>年期交费期间最长<span class="number">20</span>年交且不能选择<span class="selector-attr">[趸交]</span></span><br><span class="line">规则<span class="number">9</span>：  被保人要求：（投保年龄+保险期间）不得大于<span class="number">40</span>周岁</span><br><span class="line">规则<span class="number">10</span>： 保险金额规则：投保时约定，最低为<span class="number">5</span>万元，超过部分必须为<span class="number">1000</span>元的整数倍</span><br><span class="line">规则<span class="number">11</span>： 出单基本保额限额规则：线上出单基本保额限额<span class="number">62.5</span>万元，超<span class="number">62.5</span>万元需配合契调转线下出单</span><br></pre></td></tr></table></figure>

<p>在本案例中规则文件是一个Excel文件，业务人员可以直接更改这个文件中指标的值，系统不需要做任何变更。</p>
<h4 id="9-3-3-实现步骤"><a href="#9-3-3-实现步骤" class="headerlink" title="9.3.3 实现步骤"></a>9.3.3 实现步骤</h4><p>本案例还是基于Spring Boot整合Drools的架构来实现。</p>
<p>第一步：创建maven工程insuranceInfoCheck并配置pom.xml文件</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starters<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>insuranceInfoCheck<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--drools规则引擎--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.drools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>drools-templates<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.kie<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kie-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$</span><span class="template-variable">&#123;project.artifactId&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第二步：创建&#x2F;resources&#x2F;application.yml文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">insuranceInfoCheck</span></span><br></pre></td></tr></table></figure>

<p>第三步：创建实体类InsuranceInfo</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">package com.itheima.drools.entity;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 保险信息</span><br><span class="line"> */</span><br><span class="line">public class InsuranceInfo &#123;</span><br><span class="line">    private String param1;<span class="regexp">//</span>保险公司</span><br><span class="line">    private String param2;<span class="regexp">//</span>方案代码</span><br><span class="line">    private String param3;<span class="regexp">//</span>渠道号</span><br><span class="line">    private String param4;<span class="regexp">//</span>销售区域</span><br><span class="line">    private String param5;<span class="regexp">//</span>投保年龄</span><br><span class="line">    private String param6;<span class="regexp">//</span>保险期间</span><br><span class="line">    private String param7;<span class="regexp">//</span>缴费期间</span><br><span class="line">    private String param8;<span class="regexp">//</span>缴费方式</span><br><span class="line">    private String param9;<span class="regexp">//</span>保障类型</span><br><span class="line">    private String param10;<span class="regexp">//</span>等待期</span><br><span class="line">    private String param11;<span class="regexp">//</span>犹豫期</span><br><span class="line">    private String param12;<span class="regexp">//</span>职业类型</span><br><span class="line">    private String param13;<span class="regexp">//</span>保额限制</span><br><span class="line">    private String param14;<span class="regexp">//</span>免赔额</span><br><span class="line">    private String param15;<span class="regexp">//</span>主险保额</span><br><span class="line">    private String param16;<span class="regexp">//</span>主险保费</span><br><span class="line">    private String param17;<span class="regexp">//</span>附加险保额</span><br><span class="line">    private String param18;<span class="regexp">//</span>附加险保费</span><br><span class="line">    private String param19;<span class="regexp">//</span>与投保人关系</span><br><span class="line">    private String param20;<span class="regexp">//</span>与被保人关系</span><br><span class="line">    private String param21;<span class="regexp">//</span>性别</span><br><span class="line">    private String param22;<span class="regexp">//</span>证件</span><br><span class="line">    private String param23;<span class="regexp">//</span>保费</span><br><span class="line">    private String param24;<span class="regexp">//</span>保额</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//g</span>etter setter省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：创建决策表文件（也可以直接使用实战资料中提供的insuranceInfoCheck.xls文件）</p>
<p><img src="/blog/images/202103/image-20200218120618384.png" alt="image-20200218120618384"></p>
<p>第五步：封装工具类KieSessionUtils</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.InsuranceInfo;</span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.PersonInfoEntity;</span><br><span class="line"><span class="keyword">import</span> org.drools.decisiontable.InputType;</span><br><span class="line"><span class="keyword">import</span> org.drools.decisiontable.SpreadsheetCompiler;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.Message;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.builder.Results;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.io.ResourceType;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.kie.internal.utils.KieHelper;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KieSessionUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">KieSessionUtils</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 把xls文件解析为String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getDRL</span> <span class="params">(String realPath)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(realPath); <span class="comment">// 例如：C:\\abc.xls</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="type">SpreadsheetCompiler</span> <span class="variable">compiler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpreadsheetCompiler</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">drl</span> <span class="operator">=</span> compiler.compile(is, InputType.XLS);</span><br><span class="line">        System.out.println(drl);</span><br><span class="line">        <span class="keyword">return</span> drl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// drl为含有内容的字符串</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KieSession <span class="title function_">createKieSessionFromDRL</span><span class="params">(String drl)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">KieHelper</span> <span class="variable">kieHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KieHelper</span>();</span><br><span class="line">        kieHelper.addContent(drl, ResourceType.DRL);</span><br><span class="line">        <span class="type">Results</span> <span class="variable">results</span> <span class="operator">=</span> kieHelper.verify();</span><br><span class="line">        <span class="keyword">if</span> (results.hasMessages(Message.Level.WARNING, Message.Level.ERROR)) &#123;</span><br><span class="line">            List&lt;Message&gt; messages = results.getMessages(Message.Level.WARNING, Message.Level.ERROR);</span><br><span class="line">            <span class="keyword">for</span> (Message message : messages) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Error: &quot;</span>+message.getText());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// throw new IllegalStateException(&quot;Compilation errors were found. Check the logs.&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> kieHelper.build().newKieSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// realPath为Excel文件绝对路径</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KieSession <span class="title function_">getKieSessionFromXLS</span><span class="params">(String realPath)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> createKieSessionFromDRL(getDRL(realPath));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第六步：创建RuleService类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.InsuranceInfo;</span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.utils.KieSessionUtils;</span><br><span class="line"><span class="keyword">import</span> org.kie.api.runtime.KieSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">insuranceInfoCheck</span><span class="params">(InsuranceInfo insuranceInfo)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">KieSession</span> <span class="variable">session</span> <span class="operator">=</span> KieSessionUtils.getKieSessionFromXLS(<span class="string">&quot;D:\\rules.xls&quot;</span>);</span><br><span class="line">        session.getAgenda().getAgendaGroup(<span class="string">&quot;sign&quot;</span>).setFocus();</span><br><span class="line"></span><br><span class="line">        session.insert(insuranceInfo);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; listRules = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        session.setGlobal(<span class="string">&quot;listRules&quot;</span>, listRules);</span><br><span class="line"></span><br><span class="line">        session.fireAllRules();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> listRules;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第七步：创建RuleController类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.drools.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.entity.InsuranceInfo;</span><br><span class="line"><span class="keyword">import</span> com.itheima.drools.service.RuleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/rule&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuleService ruleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/insuranceInfoCheck&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">insuranceInfoCheck</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模拟数据，实际应为页面传递过来</span></span><br><span class="line">        <span class="type">InsuranceInfo</span> <span class="variable">insuranceInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InsuranceInfo</span>();</span><br><span class="line">        insuranceInfo.setParam1(<span class="string">&quot;picc&quot;</span>);</span><br><span class="line">        insuranceInfo.setParam4(<span class="string">&quot;上海&quot;</span>);</span><br><span class="line">        insuranceInfo.setParam5(<span class="string">&quot;101&quot;</span>);</span><br><span class="line">        insuranceInfo.setParam6(<span class="string">&quot;12&quot;</span>);</span><br><span class="line">        insuranceInfo.setParam7(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">        insuranceInfo.setParam8(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        insuranceInfo.setParam13(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; list = ruleService.insuranceInfoCheck(insuranceInfo);</span><br><span class="line">            <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                map.put(<span class="string">&quot;checkResult&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">                map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;准入失败&quot;</span>);</span><br><span class="line">                map.put(<span class="string">&quot;detail&quot;</span>,list);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(<span class="string">&quot;checkResult&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">                map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;准入成功&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            map.put(<span class="string">&quot;checkResult&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;未知错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第八步：创建启动类DroolsApplication</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">drools</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">SpringApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">autoconfigure</span>.<span class="property">SpringBootApplication</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DroolsApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">SpringApplication</span>.<span class="title function_">run</span>(<span class="title class_">DroolsApplication</span>.<span class="property">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        <div class="post-tool">
            <a class="btn-weixin-mp" href="javascript:void(0);" data-cid="52" title="95">
                <i class="fa fa-mobile" aria-hidden="true"></i> 打赏
            </a>
        </div>
        
        <div class="post-tags">标签：
            
            <a href="/blog/tags/Drools/">Drools</a>
            
            <a href="/blog/tags/%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E/">规则引擎</a>
            
        </div>
        
    </article>
    
<div id="disqus_thread"></div>

<div class="clearfix" style="margin-top: 40px;">
</div>
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<!-- UY END -->

<!--PC版-->
<div id="SOHUCS" sid="12345678"></div>
<script charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js" ></script>
<script type="text/javascript">
    window.changyan.api.config({
        appid: 'cyvlGm1zt',
        conf: 'prod_ed7bcebba567a04ee0d7b6bd13d280f8'
    });

    $(function () {
        function hash(text) {
            'use strict';
            var hash = 5381,
                index = text.length;
            while (index) {
                hash = (hash * 33) ^ text.charCodeAt(--index);
            }
            return hash >>> 0;
        }

        $('#SOHUCS').attr({
            "sid": hash(window.location.pathname)
        });
    });
</script>


<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    <!--添加友言评论系统，注释以下代码-->
    //  var disqus_config = function () {
    //      this.page.url = 'http://wuzguo.com/blog/2021/03/12/others/drools.html';
    //      this.page.identifier = '2021/03/12/others/drools.html';
    //  };
    //  (function () { // DON'T EDIT BELOW THIS LINE
    //      var d = document, disqus_shortname = 'wuzguo', s = d.createElement('script');
    //      s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    //      s.setAttribute('data-timestamp', +new Date());
    //      (d.head || d.body).appendChild(s);
    //  })();
</script>

<!--添加友言评论系统，注释以下代码-->
<!--<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->

</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        </div><!-- end #main-->


    </div><!-- end #body -->
    <footer class="footer">
    <div class="footer-inner">
        <p>
            <a href="/blog/about/" title="关于本站">关于本站</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/blog/help/" title="帮助">帮助</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/blog/video/" title="视频">视频</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <!-- 自定义链接 -->
            <a href="/blog/links/" title="友情链接">友情链接</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/blog/app/" title="应用下载">应用下载</a>
        </p>
        <br/>
        <p>哪有什么天生如此，只要你天天坚持，自律给你自由</p>
        <br/>
        <p>
            © 2016-2021 本站点基于<a href="http://hexo.io" target="_blank">Hexo</a>搭建
            ，主题作者<a href="https://www.tangkunyin.com" target="_blank">唐先森</a>，
            采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                 target="_blank">知识共享署名-非商业性使用-相同方式共享4.0国际许可协议</a>，已建站<a href="/timeline"
                                                                         id="siteBuildingTime"></a>天<br/>
        </p>
        
<p>
    <script type="text/javascript">
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1262530944'%3E%3C/span%3E%3Cscript src='//s4.cnzz.com/stat.php%3Fid%3D1262530944%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));
    </script>
</p>

    </div>
</footer>
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

<script src="/blog/css/highlight/highlight.pack.js"></script>
<script src="/blog/js/InsightSearch.js"></script>
<script src="/blog/js/SimpleCore.js"></script>


</div>
<div class="fixed-btn">
    <a class="btn-gotop" href="javascript:"> <i class="fa fa-angle-up"></i></a>
</div>

<script>
    $(function () {
        SimpleCore.init({
            buildingTime: '04/24/2016',
            current: $('.post-tags').length > 0 ? 'post' : 'archive',
            customImg: '/blog/images/weixin-mp.png'
        });

        <!--代码高亮-->
        $('.code pre').each(function (i, block) {
            hljs.highlightBlock(block);
        });
    });
</script>
<script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/blog/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>